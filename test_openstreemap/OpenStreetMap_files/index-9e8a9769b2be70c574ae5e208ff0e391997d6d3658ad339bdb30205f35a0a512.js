function FOSSGISOSRMEngine(t,e){var o=[];return{id:t,creditline:'<a href="https://routing.openstreetmap.de/about.html" target="_blank">OSRM (FOSSGIS)</a>',draggable:!0,_transformSteps:function(t,e){var o={continue:"javascripts.directions.instructions.continue","merge right":"javascripts.directions.instructions.merge_right","merge left":"javascripts.directions.instructions.merge_left","off ramp right":"javascripts.directions.instructions.offramp_right","off ramp left":"javascripts.directions.instructions.offramp_left","on ramp right":"javascripts.directions.instructions.onramp_right","on ramp left":"javascripts.directions.instructions.onramp_left","fork right":"javascripts.directions.instructions.fork_right","fork left":"javascripts.directions.instructions.fork_left","end of road right":"javascripts.directions.instructions.endofroad_right","end of road left":"javascripts.directions.instructions.endofroad_left","turn straight":"javascripts.directions.instructions.continue","turn slight right":"javascripts.directions.instructions.slight_right","turn right":"javascripts.directions.instructions.turn_right","turn sharp right":"javascripts.directions.instructions.sharp_right","turn uturn":"javascripts.directions.instructions.uturn","turn sharp left":"javascripts.directions.instructions.sharp_left","turn left":"javascripts.directions.instructions.turn_left","turn slight left":"javascripts.directions.instructions.slight_left",roundabout:"javascripts.directions.instructions.roundabout",rotary:"javascripts.directions.instructions.roundabout","exit roundabout":"javascripts.directions.instructions.exit_roundabout","exit rotary":"javascripts.directions.instructions.exit_roundabout",depart:"javascripts.directions.instructions.start",arrive:"javascripts.directions.instructions.destination"},n={continue:0,"merge right":21,"merge left":20,"off ramp right":24,"off ramp left":25,"on ramp right":2,"on ramp left":6,"fork right":18,"fork left":19,"end of road right":22,"end of road left":23,"turn straight":0,"turn slight right":1,"turn right":2,"turn sharp right":3,"turn uturn":4,"turn slight left":5,"turn left":6,"turn sharp left":7,roundabout:10,rotary:10,"exit roundabout":10,"exit rotary":10,depart:8,arrive:14},r=function(t){return["first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth"][t-1]};return t.map((function(t,i){var a;switch(t.maneuver.type){case"on ramp":case"off ramp":case"merge":case"end of road":case"fork":a=t.maneuver.type+" "+(t.maneuver.modifier.indexOf("left")>=0?"left":"right");break;case"depart":case"arrive":case"roundabout":case"rotary":case"exit roundabout":case"exit rotary":a=t.maneuver.type;break;default:a="turn "+t.maneuver.modifier}var s=o[a],l=L.PolylineUtil.decode(t.geometry,{precision:5}).map((function(t){return L.latLng(t)}));Array.prototype.push.apply(e,l);var c,u="<b>"+(i+1)+".</b> ",p="<b>"+t.destinations+"</b>",d=!0;if(t.name&&t.ref?c="<b>"+t.name+" ("+t.ref+")</b>":t.name?c="<b>"+t.name+"</b>":t.ref?c="<b>"+t.ref+"</b>":(c=I18n.t("javascripts.directions.instructions.unnamed"),d=!1),t.maneuver.type.match(/^exit (rotary|roundabout)$/))u+=I18n.t(s,{name:c});else if(t.maneuver.type.match(/^(rotary|roundabout)$/))t.maneuver.exit?t.maneuver.exit<=10?u+=I18n.t(s+"_with_exit_ordinal",{exit:I18n.t("javascripts.directions.instructions.exit_counts."+r(t.maneuver.exit)),name:c}):u+=I18n.t(s+"_with_exit",{exit:t.maneuver.exit,name:c}):u+=I18n.t(s+"_without_exit",{name:c});else if(t.maneuver.type.match(/^(on ramp|off ramp)$/)){var f={};t.exits&&t.maneuver.type.match(/^(off ramp)$/)&&(f.exit=t.exits),t.destinations&&(f.directions=p),d&&(f.directions=c),Object.keys(f).length>0&&(s=s+"_with_"+Object.keys(f).join("_")),u+=I18n.t(s,f)}else u+=I18n.t(s+"_without_exit",{name:c});return[[t.maneuver.location[1],t.maneuver.location[0]],n[a],u,t.distance,l]}))},getRoute:function(t,n){var r=[{name:"overview",value:"false"},{name:"geometries",value:"polyline"},{name:"steps",value:!0}];o.length===t.length?r.push({name:"hints",value:o.join(";")}):o=[];var i=t.map((function(t){return t.lng+","+t.lat})).join(";"),a=OSM.FOSSGIS_OSRM_URL+"routed-"+e+"/route/v1/driving/"+i,s=function(t){if("Ok"!==t.code)return n(!0);o=t.waypoints.map((function(t){return t.hint}));var e=[],r=function(t){return this._transformSteps(t.steps,e)},i=[].concat.apply([],t.routes[0].legs.map(r.bind(this)));n(!1,{line:e,steps:i,distance:t.routes[0].distance,time:t.routes[0].duration})};return $.ajax({url:a,data:r,dataType:"json",success:s.bind(this),error:function(){n(!0)}})}}}function FOSSGISValhallaEngine(t,e){var o=[0,8,8,8,14,14,14,0,0,1,2,3,4,4,7,6,5,0,24,25,24,25,0,1,5,20,10,11,17,0,null,null,null,null,null,null,null,21,20];return{id:t,creditline:"<a href='https://gis-ops.com/global-open-valhalla-server-online/' target='_blank'>Valhalla (FOSSGIS)</a>",draggable:!1,getRoute:function(t,n){return $.ajax({url:OSM.FOSSGIS_VALHALLA_URL,data:{json:JSON.stringify({locations:t.map((function(t){return{lat:t.lat,lon:t.lng,radius:5}})),costing:e,directions_options:{units:"km",language:I18n.currentLocale()}})},dataType:"json",success:function(t){var e=t.trip;if(0===e.status){var r=[],i=[],a=0,s=0;e.legs.forEach((function(t){var e=L.PolylineUtil.decode(t.shape,{precision:6});r=r.concat(e),t.maneuvers.forEach((function(t,n){var r=e[t.begin_shape_index];i.push([{lat:r[0],lng:r[1]},o[t.type],"<b>"+(n+1)+".</b> "+t.instruction,1e3*t.length,[]])})),a+=t.summary.length,s+=t.summary.time})),n(!1,{line:r,steps:i,distance:1e3*a,time:s})}else n(!0)},error:function(){n(!0)}})}}}function GraphHopperEngine(t,e){var o={"-3":7,"-2":6,"-1":5,0:0,1:1,2:2,3:3,4:14,5:14,6:10};return{id:t,creditline:'<a href="https://www.graphhopper.com/" target="_blank">GraphHopper</a>',draggable:!1,getRoute:function(t,n){return $.ajax({url:OSM.GRAPHHOPPER_URL,data:{vehicle:e,locale:I18n.currentLocale(),key:"LijBPDQGfu7Iiq80w3HzwB4RUDJbMbhs6BU0dEnn",elevation:!1,instructions:!0,turn_costs:"car"===e,point:t.map((function(t){return t.lat+","+t.lng}))},traditional:!0,dataType:"json",success:function(t){if(!t.paths||0===t.paths.length)return n(!0);for(var e=t.paths[0],r=L.PolylineUtil.decode(e.points),i=[],a=e.instructions.length,s=0;s<a;s++){var l=e.instructions[s],c=s===a-1?14:o[l.sign],u="<b>"+(s+1)+".</b> ";u+=l.text;for(var p=r[l.interval[0]],d=l.distance,f=[],h=l.interval[0];h<=l.interval[1];h++)f.push({lat:r[h][0],lng:r[h][1]});i.push([{lat:p[0],lng:p[1]},c,u,d,f])}n(!1,{line:r,steps:i,distance:e.distance,time:e.time/1e3,ascend:e.ascend,descend:e.descend})},error:function(){n(!0)}})}}}$(document).ready((function(){function t(t){t.forEach((function(t){t.addTo(n)}));var e=t[0].getContainer();$(e).find(".control-button").first().addClass("control-button-first");var o=t[t.length-1].getContainer();$(o).find(".control-button").last().addClass("control-button-last")}function e(t,e){function o(t,e){var o=$("<iframe>"),n=setTimeout((function(){alert(I18n.t("site.index.remote_failed")),o.remove()}),5e3);o.hide().appendTo("body").attr("src",t).on("load",(function(){clearTimeout(n),o.remove(),e&&e()}))}var n="http://127.0.0.1:8111",r=location.protocol+"//"+location.host,i={left:t.getWest()-1e-4,top:t.getNorth()+1e-4,right:t.getEast()+1e-4,bottom:t.getSouth()-1e-4};return e&&"note"!==e.type&&(i.select=e.type+e.id),o(n+"/load_and_zoom?"+Qs.stringify(i),(function(){if(e&&"note"===e.type){var t={url:r+OSM.apiUrl(e)};o(n+"/import?"+Qs.stringify(t))}})),!1}var o,n=new L.OSM.Map("map",{zoomControl:!1,layerControl:!1,contextmenu:!0,worldCopyJump:!0});OSM.loadSidebarContent=function(t,e){var r=t;n.setSidebarOverlaid(!1),clearTimeout(o),o=setTimeout((function(){$("#sidebar_loader").show()}),200),r.indexOf("?")>=0?r+="&xhr=1":r+="?xhr=1",$("#sidebar_content").empty(),$.ajax({url:r,dataType:"html",complete:function(t){clearTimeout(o),$("#flash").empty(),$("#sidebar_loader").hide();var n=$(t.responseText);if(t.getResponseHeader("X-Page-Title")){var r=t.getResponseHeader("X-Page-Title");document.title=decodeURIComponent(r)}$("head").find('link[type="application/atom+xml"]').remove(),$("head").append(n.filter('link[type="application/atom+xml"]')),$("#sidebar_content").html(n.not('link[type="application/atom+xml"]')),e&&e()}})};var r=OSM.mapParams();n.attributionControl.setPrefix(""),n.updateLayers(r.layers),n.on("baselayerchange",(function(t){n.getZoom()>t.layer.options.maxZoom&&n.setView(n.getCenter(),t.layer.options.maxZoom,{reset:!0})}));var i=L.OSM.sidebar("#map-ui").addTo(n),a="rtl"===$("html").attr("dir")?"topleft":"topright";t([L.OSM.zoom({position:a}),L.OSM.locate({position:a})]),t([L.OSM.layers({position:a,layers:n.baseLayers,sidebar:i}),L.OSM.key({position:a,sidebar:i}),L.OSM.share({position:a,sidebar:i,short:!0})]),t([L.OSM.note({position:a,sidebar:i})]),t([L.OSM.query({position:a,sidebar:i})]),L.control.scale().addTo(n),OSM.initializeContextMenu(n),"api_offline"!==OSM.STATUS&&"database_offline"!==OSM.STATUS&&(OSM.initializeNotes(n),r.layers.indexOf(n.noteLayer.options.code)>=0&&n.addLayer(n.noteLayer),OSM.initializeBrowse(n),r.layers.indexOf(n.dataLayer.options.code)>=0&&n.addLayer(n.dataLayer),r.layers.indexOf(n.gpsLayer.options.code)>=0&&n.addLayer(n.gpsLayer)),$(".leaflet-control .control-button").tooltip({placement:"left",container:"body"});var s=new Date;s.setYear(s.getFullYear()+10),n.on("moveend layeradd layerremove",(function(){updateLinks(n.getCenter().wrap(),n.getZoom(),n.getLayersCode(),n._object),Cookies.set("_osm_location",OSM.locationCookie(n),{secure:!0,expires:s,path:"/",samesite:"lax"})})),"hide"!==Cookies.get("_osm_welcome")&&$(".welcome").removeAttr("hidden"),$(".welcome .btn-close").on("click",(function(){$(".welcome").hide(),Cookies.set("_osm_welcome","hide",{secure:!0,expires:s,path:"/",samesite:"lax"})}));var l=new Date;l.setYear(l.getFullYear()+1),$("#banner .btn-close").on("click",(function(t){var e=t.target.id;$("#banner").hide(),t.preventDefault(),e&&Cookies.set(e,"hide",{secure:!0,expires:l,path:"/",samesite:"lax"})})),OSM.MATOMO&&n.on("layeradd",(function(t){if(t.layer.options){var e=OSM.MATOMO.goals[t.layer.options.keyid];e&&$("body").trigger("matomogoal",e)}})),r.bounds?n.fitBounds(r.bounds):n.setView([r.lat,r.lon],r.zoom),r.marker&&L.marker([r.mlat,r.mlon]).addTo(n),$("#homeanchor").on("click",(function(t){t.preventDefault();var e=$(this).data(),o=L.latLng(e.lat,e.lon);n.setView(o,e.zoom),L.marker(o,{icon:OSM.getUserIcon()}).addTo(n)})),$("a[data-editor=remote]").click((function(t){var o=OSM.mapParams(this.search);e(n.getBounds(),o.object),t.preventDefault()})),OSM.params().edit_help&&($("#editanchor").removeAttr("title").tooltip({placement:"bottom",title:I18n.t("javascripts.edit_help")}).tooltip("show"),$("body").one("click",(function(){$("#editanchor").tooltip("hide")}))),OSM.Index=function(t){var e={};return e.pushstate=e.popstate=function(){t.setSidebarOverlaid(!0),document.title=I18n.t("layouts.project_name.title")},e.load=function(){var e=Qs.parse(location.search.substring(1));return e.query&&$("#sidebar .search_form input[name=query]").value(e.query),"autofocus"in document.createElement("input")||$("#sidebar .search_form input[name=query]").focus(),t.getState()},e},OSM.Browse=function(t,e){function o(e,o,n){t.addObject({type:e,id:parseInt(o,10)},(function(e){window.location.hash||!e.isValid()||!n&&t.getBounds().contains(e)||OSM.router.withoutMoveListener((function(){t.fitBounds(e)}))}))}var n={};return n.pushstate=n.popstate=function(t,n){OSM.loadSidebarContent(t,(function(){o(e,n)}))},n.load=function(t,n){o(e,n,!0)},n.unload=function(){t.removeObject()},n},OSM.OldBrowse=function(){var t={};return t.pushstate=t.popstate=function(t){OSM.loadSidebarContent(t)},t};var c=OSM.History(n);OSM.router=OSM.Router(n,{"/":OSM.Index(n),"/search":OSM.Search(n),"/directions":OSM.Directions(n),"/export":OSM.Export(n),"/note/new":OSM.NewNote(n),"/history/friends":c,"/history/nearby":c,"/history":c,"/user/:display_name/history":c,"/note/:id":OSM.Note(n),"/node/:id(/history)":OSM.Browse(n,"node"),"/node/:id/history/:version":OSM.OldBrowse(),"/way/:id(/history)":OSM.Browse(n,"way"),"/way/:id/history/:version":OSM.OldBrowse(),"/relation/:id(/history)":OSM.Browse(n,"relation"),"/relation/:id/history/:version":OSM.OldBrowse(),"/changeset/:id":OSM.Changeset(n),"/query":OSM.Query(n)}),"remote"===OSM.preferred_editor&&"/edit"===document.location.pathname&&(e(n.getBounds(),r.object),OSM.router.setCurrentPath("/")),OSM.router.load(),$(document).on("click","a",(function(t){t.isDefaultPrevented()||t.isPropagationStopped()||t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||location.protocol===this.protocol&&location.host===this.host&&OSM.router.route(this.pathname+this.search+this.hash)&&t.preventDefault()})),$(document).on("click","#sidebar_content .btn-close",(function(){OSM.router.route("/"+OSM.formatHash(n))}))})),L.OSM.sidebar=function(t){var e,o={},n=$(t),r=$(),i=$();return o.addTo=function(t){return e=t,o},o.addPane=function(t){t.hide().appendTo(n)},o.togglePane=function(t,o){var a=250;r.hide().trigger("hide"),i.removeClass("active"),r===t?("rtl"===$("html").attr("dir")&&e.panBy([-a,0],{animate:!1}),$(n).hide(),r=i=$()):($(n).show(),r=t,i=o||$(),"rtl"===$("html").attr("dir")&&e.panBy([a,0],{animate:!1})),e.invalidateSize({pan:!1,animate:!1}),r.show().trigger("show"),i.addClass("active")},o},L.OSM.sidebarPane=function(t,e,o,n){var r=L.control(t);return r.onAdd=function(r){function i(e){e.stopPropagation(),e.preventDefault(),s.hasClass("disabled")||t.sidebar.togglePane(l,s),$(".leaflet-control .control-button").tooltip("hide")}var a=$("<div>").attr("class","control-"+e),s=$("<a>").attr("class","control-button").attr("href","#").html('<span class="icon '+e+'"></span>').on("click",i);o&&s.attr("title",I18n.t(o)),s.appendTo(a);var l=$("<div>").attr("class",e+"-ui");return $("<div class='d-flex p-3 pb-0'>").appendTo(l).append($("<h2 class='flex-grow-1 text-break'>").text(I18n.t(n))).append($("<div>").append($("<button type='button' class='btn-close'>").attr("aria-label",I18n.t("javascripts.close")).bind("click",i))),t.sidebar.addPane(l),this.onAddPane(r,s,l,i),a[0]},r},
/*!
Copyright (c) 2016 Dominik Moritz

This file is part of the leaflet locate control. It is licensed under the MIT license.
You can find the project at: https://github.com/domoritz/leaflet-locatecontrol
*/
function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(void 0!==e&&e.L?module.exports=t(L):module.exports=t(require("leaflet"))),void 0!==e&&e.L&&(e.L.Control.Locate=t(L))}((function(t){const e=(e,o,n)=>{(n=n.split(" ")).forEach((function(n){t.DomUtil[e].call(this,o,n)}))},o=(t,o)=>e("addClass",t,o),n=(t,o)=>e("removeClass",t,o),r=t.Marker.extend({initialize(e,o){t.Util.setOptions(this,o),this._latlng=e,this.createIcon()},createIcon(){const e=this.options;let o="";void 0!==e.color&&(o+=`stroke:${e.color};`),void 0!==e.weight&&(o+=`stroke-width:${e.weight};`),void 0!==e.fillColor&&(o+=`fill:${e.fillColor};`),void 0!==e.fillOpacity&&(o+=`fill-opacity:${e.fillOpacity};`),void 0!==e.opacity&&(o+=`opacity:${e.opacity};`);const n=this._getIconSVG(e,o);this._locationIcon=t.divIcon({className:n.className,html:n.svg,iconSize:[n.w,n.h]}),this.setIcon(this._locationIcon)},_getIconSVG(t,e){const o=t.radius,n=o+t.weight,r=2*n;return{className:"leaflet-control-locate-location",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${r}" version="1.1" viewBox="-${n} -${n} ${r} ${r}"><circle r="`+o+'" style="'+e+'" /></svg>',w:r,h:r}},setStyle(e){t.Util.setOptions(this,e),this.createIcon()}}),i=r.extend({initialize(e,o,n){t.Util.setOptions(this,n),this._latlng=e,this._heading=o,this.createIcon()},setHeading(t){this._heading=t},_getIconSVG(t,e){const o=t.radius,n=t.width+t.weight,r=2*(o+t.depth+t.weight),i=`M0,0 l${t.width/2},${t.depth} l-${n},0 z`;return{className:"leaflet-control-locate-heading",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${r}" version="1.1" viewBox="-${n/2} 0 ${n} ${r}" style="${`transform: rotate(${this._heading}deg)`}"><path d="`+i+'" style="'+e+'" /></svg>',w:n,h:r}}}),a=t.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,initialZoomLevel:!1,getLocationBounds:t=>t.bounds,flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:r,compassClass:i,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"leaflet-control-locate-location-arrow",iconLoading:"leaflet-control-locate-spinner",iconElementTag:"span",textElementTag:"small",circlePadding:[0,0],metric:!0,createButtonCallback(e,o){const n=t.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",e);n.title=o.strings.title,n.href="#",n.setAttribute("role","button");const r=t.DomUtil.create(o.iconElementTag,o.icon,n);if(void 0!==o.strings.text){t.DomUtil.create(o.textElementTag,"leaflet-locate-text",n).textContent=o.strings.text,n.classList.add("leaflet-locate-text-active"),n.parentNode.style.display="flex",o.icon.length>0&&r.classList.add("leaflet-locate-icon")}return{link:n,icon:r}},onLocationError(t,e){alert(t.message)},onLocationOutsideMapBounds(t){t.stop(),alert(t.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize(e){for(const o in e)"object"==typeof this.options[o]?t.extend(this.options[o],e[o]):this.options[o]=e[o];this.options.followMarkerStyle=t.extend({},this.options.markerStyle,this.options.followMarkerStyle),this.options.followCircleStyle=t.extend({},this.options.circleStyle,this.options.followCircleStyle),this.options.followCompassStyle=t.extend({},this.options.compassStyle,this.options.followCompassStyle)},onAdd(e){const o=t.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._container=o,this._map=e,this._layer=this.options.layer||new t.LayerGroup,this._layer.addTo(e),this._event=void 0,this._compassHeading=null,this._prevBounds=null;const n=this.options.createButtonCallback(o,this.options);return this._link=n.link,this._icon=n.icon,t.DomEvent.on(this._link,"click",(function(e){t.DomEvent.stopPropagation(e),t.DomEvent.preventDefault(e),this._onClick()}),this).on(this._link,"dblclick",t.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),o},_onClick(){this._justClicked=!0;const t=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active){const e=this.options.clickBehavior;let o=e.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(o=t?e.inView:e.inViewNotFollowing),e[o]&&(o=e[o]),o){case"setView":this.setView();break;case"stop":if(this.stop(),this.options.returnToPrevBounds){(this.options.flyTo?this._map.flyToBounds:this._map.fitBounds).bind(this._map)(this._prevBounds)}}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate(){if(!this._active&&this._map&&(this._map.locate(this.options.locateOptions),this._map.fire("locateactivate",this),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass)){const e="ondeviceorientationabsolute"in window;if(e||"ondeviceorientation"in window){const o=this,n=function(){t.DomEvent.on(window,e?"deviceorientationabsolute":"deviceorientation",o._onDeviceOrientation,o)};DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t&&n()})):n()}}},_deactivate(){this._active&&this._map&&(this._map.stopLocate(),this._map.fire("locatedeactivate",this),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?t.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&t.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this)))},setView(){if(this._drawMarker(),this._isOutsideMapBounds())this._event=void 0,this.options.onLocationOutsideMapBounds(this);else if(this._justClicked&&!1!==this.options.initialZoomLevel)(e=this.options.flyTo?this._map.flyTo:this._map.setView).bind(this._map)([this._event.latitude,this._event.longitude],this.options.initialZoomLevel);else if(this.options.keepCurrentZoomLevel){(e=this.options.flyTo?this._map.flyTo:this._map.panTo).bind(this._map)([this._event.latitude,this._event.longitude])}else{var e=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=!0,e.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.initialZoomLevel||this.options.locateOptions.maxZoom}),t.Util.requestAnimFrame((function(){this._ignoreEvent=!1}),this)}},_drawCompass(){if(!this._event)return;const t=this._event.latlng;if(this.options.showCompass&&t&&null!==this._compassHeading){const e=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(t),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(e)):this._compass=new this.options.compassClass(t,this._compassHeading,e).addTo(this._layer)}!this._compass||this.options.showCompass&&null!==this._compassHeading||(this._compass.removeFrom(this._layer),this._compass=null)},_drawMarker(){function e(){return"string"==typeof a?t.Util.template(a,{distance:r,unit:i}):"function"==typeof a?a({distance:r,unit:i}):a}void 0===this._event.accuracy&&(this._event.accuracy=0);const o=this._event.accuracy,n=this._event.latlng;if(this.options.drawCircle){const e=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(n).setRadius(o).setStyle(e):this._circle=t.circle(n,o,e).addTo(this._layer)}let r,i;if(this.options.metric?(r=o.toFixed(0),i=this.options.strings.metersUnit):(r=(3.2808399*o).toFixed(0),i=this.options.strings.feetUnit),this.options.drawMarker){const t=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(n),this._marker.setStyle&&this._marker.setStyle(t)):this._marker=new this.options.markerClass(n,t).addTo(this._layer)}this._drawCompass();const a=this.options.strings.popup;this.options.showPopup&&a&&this._marker&&this._marker.bindPopup(e())._popup.setLatLng(n),this.options.showPopup&&a&&this._compass&&this._compass.bindPopup(e())._popup.setLatLng(n)},_removeMarker(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},_unload(){this.stop(),this._map.off("unload",this._unload,this)},_setCompassHeading(e){!isNaN(parseFloat(e))&&isFinite(e)?(e=Math.round(e),this._compassHeading=e,t.Util.requestAnimFrame(this._drawCompass,this)):this._compassHeading=null},_onCompassNeedsCalibration(){this._setCompassHeading()},_onDeviceOrientation(t){this._active&&(t.webkitCompassHeading?this._setCompassHeading(t.webkitCompassHeading):t.absolute&&t.alpha&&this._setCompassHeading(360-t.alpha))},_onLocationError(t){3==t.code&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(t,this))},_onLocationFound(t){if((!this._event||this._event.latlng.lat!==t.latlng.lat||this._event.latlng.lng!==t.latlng.lng||this._event.accuracy!==t.accuracy)&&this._active){switch(this._event=t,this._drawMarker(),this._updateContainerStyle(),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":this._userPanned||this._userZoomed||this.setView();break;case"always":this.setView()}this._justClicked=!1}},_onDrag(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing(){return!!this._active&&("always"===this.options.setView||("untilPan"===this.options.setView?!this._userPanned:"untilPanOrZoom"===this.options.setView?!this._userPanned&&!this._userZoomed:void 0))},_isOutsideMapBounds(){return void 0!==this._event&&(this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng))},_updateContainerStyle(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses(t){"requesting"==t?(n(this._container,"active following"),o(this._container,"requesting"),n(this._icon,this.options.icon),o(this._icon,this.options.iconLoading)):"active"==t?(n(this._container,"requesting following"),o(this._container,"active"),n(this._icon,this.options.iconLoading),o(this._icon,this.options.icon)):"following"==t&&(n(this._container,"requesting"),o(this._container,"active following"),n(this._icon,this.options.iconLoading),o(this._icon,this.options.icon))},_cleanClasses(){t.DomUtil.removeClass(this._container,"requesting"),t.DomUtil.removeClass(this._container,"active"),t.DomUtil.removeClass(this._container,"following"),n(this._icon,this.options.iconLoading),o(this._icon,this.options.icon)},_resetVariables(){this._active=!1,this._justClicked=!1,this._userPanned=!1,this._userZoomed=!1}});return t.control.locate=e=>new t.Control.Locate(e),a}),window),L.OSM.locate=function(t){var e=L.control.locate(Object.assign({icon:"icon geolocate",iconLoading:"icon geolocate",strings:{title:I18n.t("javascripts.map.locate.title"),popup:function(t){return I18n.t("javascripts.map.locate."+t.unit+"Popup",{count:t.distance})}}},t));return e.onAdd=function(t){var e=Object.getPrototypeOf(this).onAdd.apply(this,[t]);return $(e).removeClass("leaflet-control-locate leaflet-bar").addClass("control-locate").children("a").attr("href","#").removeClass("leaflet-bar-part leaflet-bar-part-single").addClass("control-button"),e},e},L.OSM.layers=function(t){var e=L.OSM.sidebarPane(t,"layers","javascripts.map.layers.title","javascripts.map.layers.header");return e.onAddPane=function(e,o,n,r){var i=t.layers,a=$("<div>").attr("class","section base-layers").appendTo(n),s=$("<ul class='list-unstyled mb-0'>").appendTo(a);if(i.forEach((function(t){var o=$("<li>").attr("class","rounded-3").appendTo(s);e.hasLayer(t)&&o.addClass("active");var a=$("<div>").appendTo(o);e.whenReady((function(){function o(){l.invalidateSize(),s({animate:!1}),e.on("moveend",i)}function r(){e.off("moveend",i)}function i(){s()}function s(t){l.setView(e.getCenter(),Math.max(e.getZoom()-2,0),t)}var l=L.map(a[0],{attributionControl:!1,zoomControl:!1,keyboard:!1}).addLayer(new t.constructor({apikey:t.options.apikey}));l.dragging.disable(),l.touchZoom.disable(),l.doubleClickZoom.disable(),l.scrollWheelZoom.disable(),n.on("show",o).on("hide",r)}));var l=$("<label>").appendTo(o),c=$("<input>").attr("type","radio").prop("checked",e.hasLayer(t)).appendTo(l);l.append(t.options.name),o.on("click",(function(){i.forEach((function(o){o===t?e.addLayer(o):e.removeLayer(o)})),e.fire("baselayerchange",{layer:t})})),o.on("dblclick",r),e.on("layeradd layerremove",(function(){o.toggleClass("active",e.hasLayer(t)),c.prop("checked",e.hasLayer(t))}))})),"api_offline"!==OSM.STATUS&&"database_offline"!==OSM.STATUS){var l=$("<div>").attr("class","section overlay-layers").appendTo(n);$("<p>").text(I18n.t("javascripts.map.layers.overlays")).attr("class","text-muted").appendTo(l);var c=$("<ul class='list-unstyled form-check'>").appendTo(l),u=function(t,o,n){var r=$("<li>").appendTo(c);"notes"!==o&&"data"!==o||r.attr("title",I18n.t("javascripts.site.map_"+o+"_zoom_in_tooltip")).tooltip("disable");var i=$("<label>").attr("class","form-check-label").appendTo(r),a=e.hasLayer(t),s=$("<input>").attr("type","checkbox").attr("class","form-check-input").prop("checked",a).appendTo(i);i.append(I18n.t("javascripts.map.layers."+o)),s.on("change",(function(){(a=s.is(":checked"))?e.addLayer(t):e.removeLayer(t),e.fire("overlaylayerchange",{layer:t})})),e.on("layeradd layerremove",(function(){s.prop("checked",e.hasLayer(t))})),e.on("zoomend",(function(){var t=e.getBounds().getSize()>=n;$(s).prop("disabled",t),t&&$(s).is(":checked")?($(s).prop("checked",!1).trigger("change"),a=!0):t||$(s).is(":checked")||!a||$(s).prop("checked",!0).trigger("change"),$(r).attr("class",t?"disabled":"").tooltip(t?"enable":"disable")}))};u(e.noteLayer,"notes",OSM.MAX_NOTE_REQUEST_AREA),u(e.dataLayer,"data",OSM.MAX_REQUEST_AREA),u(e.gpsLayer,"gps",Number.POSITIVE_INFINITY)}},e},L.OSM.key=function(t){var e=L.OSM.sidebarPane(t,"key",null,"javascripts.key.title");return e.onAddPane=function(t,e,o){function n(){t.on("zoomend baselayerchange",a),s.load("/key",a)}function r(){t.off("zoomend baselayerchange",a)}function i(){var o=-1===OSM.LAYERS_WITH_MAP_KEY.indexOf(t.getMapBaseLayerId());e.toggleClass("disabled",o).attr("data-bs-original-title",I18n.t(o?"javascripts.key.tooltip_disabled":"javascripts.key.tooltip"))}function a(){var e=t.getMapBaseLayerId(),o=t.getZoom();$(".mapkey-table-entry").each((function(){var t=$(this).data();$(this).toggle(e===t.layer&&(!t.zoomMin||o>=t.zoomMin)&&(!t.zoomMax||o<=t.zoomMax))}))}var s=$("<div>").attr("class","section").appendTo(o);o.on("show",n).on("hide",r),t.on("baselayerchange",i),i()},e},L.OSM.note=function(t){var e=L.control(t);return e.onAdd=function(t){function e(){var e="database_offline"===OSM.STATUS||t.getZoom()<12;n.toggleClass("disabled",e).attr("data-bs-original-title",I18n.t(e?"javascripts.site.createnote_disabled_tooltip":"javascripts.site.createnote_tooltip"))}var o=$("<div>").attr("class","control-note"),n=$("<a>").attr("class","control-button").attr("href","#").html('<span class="icon note"></span>').appendTo(o);return t.on("zoomend",e),e(),o[0]},e},L.OSM.share=function(t){var e=L.OSM.sidebarPane(t,"share","javascripts.share.title","javascripts.share.title"),o=L.marker([0,0],{draggable:!0}),n=new L.LocationFilter({enableButton:!1,adjustButton:!1});return e.onAddPane=function(t,e,r){function i(){$("#mapnik_scale").val(m()),f()}function a(){t.removeLayer(o),t.options.scrollWheelZoom=t.options.doubleClickZoom=!0,n.disable(),f()}function s(){$(this).is(":checked")?(o.setLatLng(t.getCenter()),t.addLayer(o),t.options.scrollWheelZoom=t.options.doubleClickZoom="center"):(t.removeLayer(o),t.options.scrollWheelZoom=t.options.doubleClickZoom=!0),f()}function l(){$(this).is(":checked")?(n.setBounds(t.getBounds().pad(-.2)),n.enable()):n.disable(),f()}function c(){o.setLatLng(t.getCenter()),f()}function u(){t.hasLayer(o)&&(t.off("move",c),t.on("moveend",p),t.panTo(o.getLatLng()))}function p(){t.off("moveend",p),t.on("move",c),f()}function d(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return null===t?"":String(t).replace(/[&<>"']/g,(function(t){return e[t]}))}function f(){var e="tracestracktopo"!==t.getMapBaseLayerId(),r=t.getBounds();$("#link_marker").prop("checked",t.hasLayer(o)),$("#image_filter").prop("checked",n.isEnabled()),$("#short_input").val(t.getShortUrl(o)),$("#long_input").val(t.getUrl(o)),$("#short_link").attr("href",t.getShortUrl(o)),$("#long_link").attr("href",t.getUrl(o));var i={bbox:r.toBBoxString(),layer:t.getMapBaseLayerId()};if(t.hasLayer(o)){var a=o.getLatLng().wrap();i.marker=a.lat+","+a.lng}$("#embed_link").toggleClass("btn-primary",e).toggleClass("btn-secondary",!e).tooltip(e?"disable":"enable"),!e&&$("#embed_link").hasClass("active")&&$("#long_link").click(),$("#embed_html").val('<iframe width="425" height="350" src="'+d(OSM.SERVER_PROTOCOL+"://"+OSM.SERVER_URL+"/export/embed.html?"+$.param(i))+'" style="border: 1px solid black"></iframe><br/><small><a href="'+d(t.getUrl(o))+'">'+d(I18n.t("javascripts.share.view_larger_map"))+"</a></small>"),$("#geo_uri").attr("href",t.getGeoUri(o)).html(t.getGeoUri(o)),n.isEnabled()&&(r=n.getBounds());var s=$("#mapnik_scale").val(),l=L.bounds(L.CRS.EPSG3857.project(r.getSouthWest()),L.CRS.EPSG3857.project(r.getNorthEast())).getSize(),c=Math.floor(Math.sqrt(l.x*l.y/.3136));$("#mapnik_minlon").val(r.getWest()),$("#mapnik_minlat").val(r.getSouth()),$("#mapnik_maxlon").val(r.getEast()),$("#mapnik_maxlat").val(r.getNorth()),s<c&&(s=y(c),$("#mapnik_scale").val(s)),$("#mapnik_image_width").text(Math.round(l.x/s/28e-5)),$("#mapnik_image_height").text(Math.round(l.y/s/28e-5)),"mapnik"===t.getMapBaseLayerId()?($("#export-image").show(),$("#export-warning").hide()):($("#export-image").hide(),$("#export-warning").show())}function h(){$(this).select()}function m(){var e=t.getBounds(),o=e.getCenter().lat,n=6378137*Math.PI*Math.cos(o*Math.PI/180)*(e.getEast()-e.getWest())/180,r=t.getSize().x/n,i=1/3622.0492;return Math.round(1/(r*i))}function y(t){var e=5*Math.pow(10,Math.floor(Math.LOG10E*Math.log(t))-2);return e*Math.ceil(t/e)}var g=$("<div>").attr("class","section share-link").appendTo(r);$("<h4>").text(I18n.t("javascripts.share.link")).appendTo(g);var v=$("<form>").appendTo(g);$("<div>").attr("class","form-check mb-3").appendTo(v).append($("<label>").attr("for","link_marker").attr("class","form-check-label").text(I18n.t("javascripts.share.include_marker"))).append($("<input>").attr("id","link_marker").attr("type","checkbox").attr("class","form-check-input").bind("change",s)),$("<div class='btn-group btn-group-sm mb-2'>").appendTo(v).append($("<a class='btn btn-primary'>").addClass("active").attr("for","long_input").attr("id","long_link").text(I18n.t("javascripts.share.long_link"))).append($("<a class='btn btn-primary'>").attr("for","short_input").attr("id","short_link").text(I18n.t("javascripts.share.short_link"))).append($("<a class='btn btn-primary'>").attr("for","embed_html").attr("id","embed_link").attr("data-bs-title",I18n.t("javascripts.site.embed_html_disabled")).attr("href","#").text(I18n.t("javascripts.share.embed"))).on("click","a",(function(t){if(t.preventDefault(),$(this).hasClass("btn-primary")){var e="#"+$(this).attr("for");$(this).siblings("a").removeClass("active"),$(this).addClass("active"),g.find(".share-tab").hide(),g.find(".share-tab:has("+e+")").show().find("input, textarea").select()}})),$("<div>").attr("class","share-tab").appendTo(v).append($("<input>").attr("id","long_input").attr("type","text").attr("class","form-control form-control-sm font-monospace").attr("readonly",!0).on("click",h)),$("<div>").attr("class","share-tab").hide().appendTo(v).append($("<input>").attr("id","short_input").attr("type","text").attr("class","form-control form-control-sm font-monospace").attr("readonly",!0).on("click",h)),$("<div>").attr("class","share-tab").hide().appendTo(v).append($("<textarea>").attr("id","embed_html").attr("class","form-control form-control-sm font-monospace").attr("readonly",!0).on("click",h)).append($("<p>").attr("class","text-muted").text(I18n.t("javascripts.share.paste_html")));var b=$("<div>").attr("class","section share-geo-uri").appendTo(r);$("<h4>").text(I18n.t("javascripts.share.geo_uri")).appendTo(b),$("<div>").appendTo(b).append($("<a>").attr("id","geo_uri"));var _=$("<div>").attr("class","section share-image").appendTo(r);$("<h4>").text(I18n.t("javascripts.share.image")).appendTo(_),$("<div>").attr("id","export-warning").attr("class","text-muted").text(I18n.t("javascripts.share.only_standard_layer")).appendTo(_),v=$("<form>").attr("id","export-image").attr("action","/export/finish").attr("method","post").appendTo(_),$("<div>").appendTo(v).attr("class","row mb-3").append($("<label>").attr("for","mapnik_format").attr("class","col-auto col-form-label").text(I18n.t("javascripts.share.format"))).append($("<div>").attr("class","col-auto").append($("<select>").attr("name","mapnik_format").attr("id","mapnik_format").attr("class","form-select w-auto").append($("<option>").val("png").text("PNG").prop("selected",!0)).append($("<option>").val("jpeg").text("JPEG")).append($("<option>").val("svg").text("SVG")).append($("<option>").val("pdf").text("PDF")))),$("<div>").appendTo(v).attr("class","row mb-3").append($("<label>").attr("for","mapnik_scale").attr("class","col-auto col-form-label").text(I18n.t("javascripts.share.scale"))).append($("<div>").attr("class","col-auto").append($("<div>").attr("class","input-group flex-nowrap").append($("<span>").attr("class","input-group-text").text("1 : ")).append($("<input>").attr("name","mapnik_scale").attr("id","mapnik_scale").attr("type","text").attr("class","form-control").on("change",f)))),$("<div>").attr("class","row mb-3").appendTo(v).append($("<div>").attr("class","col-auto").append($("<div>").attr("class","form-check").append($("<label>").attr("for","image_filter").attr("class","form-check-label").text(I18n.t("javascripts.share.custom_dimensions"))).append($("<input>").attr("id","image_filter").attr("type","checkbox").attr("class","form-check-input").bind("change",l)))),["minlon","minlat","maxlon","maxlat"].forEach((function(t){$("<input>").attr("id","mapnik_"+t).attr("name",t).attr("type","hidden").appendTo(v)})),$("<input>").attr("name","format").attr("value","mapnik").attr("type","hidden").appendTo(v);var w=$("meta[name=csrf-param]").attr("content"),S=$("meta[name=csrf-token]").attr("content");$("<input>").attr("name",w).attr("value",S).attr("type","hidden").appendTo(v);var x={width:'<span id="mapnik_image_width"></span>',height:'<span id="mapnik_image_height"></span>'};$("<p>").attr("class","text-muted").html(I18n.t("javascripts.share.image_dimensions",x)).appendTo(v),$("<input>").attr("type","submit").attr("class","btn btn-primary").attr("value",I18n.t("javascripts.share.download")).appendTo(v),n.on("change",f).addTo(t),o.on("dragend",u),t.on("move",c),t.on("moveend layeradd layerremove",f),r.on("show",i).on("hide",a)},e},function(){"use strict";var t=function(t){return(t="number"==typeof t?{precision:t}:t||{}).precision=t.precision||5,t.factor=t.factor||Math.pow(10,t.precision),t.dimension=t.dimension||2,t},e={encode:function(e,o){o=t(o);for(var n=[],r=0,i=e.length;r<i;++r){var a=e[r];if(2===o.dimension)n.push(a.lat||a[0]),n.push(a.lng||a[1]);else for(var s=0;s<o.dimension;++s)n.push(a[s])}return this.encodeDeltas(n,o)},decode:function(e,o){o=t(o);for(var n=this.decodeDeltas(e,o),r=[],i=0,a=n.length;i+(o.dimension-1)<a;){for(var s=[],l=0;l<o.dimension;++l)s.push(n[i++]);r.push(s)}return r},encodeDeltas:function(e,o){o=t(o);for(var n=[],r=0,i=e.length;r<i;)for(var a=0;a<o.dimension;++a,++r){var s=e[r].toFixed(o.precision),l=s-(n[a]||0);n[a]=s,e[r]=l}return this.encodeFloats(e,o)},decodeDeltas:function(e,o){o=t(o);for(var n=[],r=this.decodeFloats(e,o),i=0,a=r.length;i<a;)for(var s=0;s<o.dimension;++s,++i)r[i]=Math.round((n[s]=r[i]+(n[s]||0))*o.factor)/o.factor;return r},encodeFloats:function(e,o){o=t(o);for(var n=0,r=e.length;n<r;++n)e[n]=Math.round(e[n]*o.factor);return this.encodeSignedIntegers(e)},decodeFloats:function(e,o){o=t(o);for(var n=this.decodeSignedIntegers(e),r=0,i=n.length;r<i;++r)n[r]/=o.factor;return n},encodeSignedIntegers:function(t){for(var e=0,o=t.length;e<o;++e){var n=t[e];t[e]=n<0?~(n<<1):n<<1}return this.encodeUnsignedIntegers(t)},decodeSignedIntegers:function(t){for(var e=this.decodeUnsignedIntegers(t),o=0,n=e.length;o<n;++o){var r=e[o];e[o]=1&r?~(r>>1):r>>1}return e},encodeUnsignedIntegers:function(t){for(var e="",o=0,n=t.length;o<n;++o)e+=this.encodeUnsignedInteger(t[o]);return e},decodeUnsignedIntegers:function(t){for(var e=[],o=0,n=0,r=0,i=t.length;r<i;++r){var a=t.charCodeAt(r)-63;o|=(31&a)<<n,a<32?(e.push(o),o=0,n=0):n+=5}return e},encodeSignedInteger:function(t){return t=t<0?~(t<<1):t<<1,this.encodeUnsignedInteger(t)},encodeUnsignedInteger:function(t){for(var e,o="";t>=32;)e=63+(32|31&t),o+=String.fromCharCode(e),t>>=5;return e=t+63,o+=String.fromCharCode(e)}};if("object"==typeof module&&"object"==typeof module.exports&&(module.exports=e),"object"==typeof L){L.Polyline.prototype.fromEncoded||(L.Polyline.fromEncoded=function(t,o){return L.polyline(e.decode(t),o)}),L.Polygon.prototype.fromEncoded||(L.Polygon.fromEncoded=function(t,o){return L.polygon(e.decode(t),o)});var o={encodePath:function(){return e.encode(this.getLatLngs())}};L.Polyline.prototype.encodePath||L.Polyline.include(o),L.Polygon.prototype.encodePath||L.Polygon.include(o),L.PolylineUtil=e}}(),L.OSM.query=function(t){var e=L.control(t);return e.onAdd=function(t){function e(){var e=n.hasClass("disabled"),o=t.getZoom()<14;n.toggleClass("disabled",o).attr("data-bs-original-title",I18n.t(o?"javascripts.site.queryfeature_disabled_tooltip":"javascripts.site.queryfeature_tooltip")),o&&!e?n.trigger("disabled"):e&&!o&&n.trigger("enabled")}var o=$("<div>").attr("class","control-query"),n=$("<a>").attr("class","control-button").attr("href","#").html('<span class="icon query"></span>').appendTo(o);return t.on("zoomend",e),e(),o[0]},e},function(t){var e;if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("object"==typeof module&&"object"==typeof module.exports)e=require("leaflet"),module.exports=t(e);else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");t(window.L)}}((function(t){t.Map.mergeOptions({contextmenuItems:[]}),t.Map.ContextMenu=t.Handler.extend({_touchstart:t.Browser.msPointer?"MSPointerDown":t.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(e){t.Handler.prototype.initialize.call(this,e),this._items=[],this._visible=!1;var o=this._container=t.DomUtil.create("div",t.Map.ContextMenu.BASE_CLS,e._container);o.style.zIndex=1e4,o.style.position="absolute",e.options.contextmenuWidth&&(o.style.width=e.options.contextmenuWidth+"px"),this._createItems(),t.DomEvent.on(o,"click",t.DomEvent.stop).on(o,"mousedown",t.DomEvent.stop).on(o,"dblclick",t.DomEvent.stop).on(o,"contextmenu",t.DomEvent.stop)},addHooks:function(){var e=this._map.getContainer();t.DomEvent.on(e,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),t.Browser.touch&&t.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var e=this._map.getContainer();t.DomEvent.off(e,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),t.Browser.touch&&t.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},showAt:function(e,o){e instanceof t.LatLng&&(e=this._map.latLngToContainerPoint(e)),this._showAtPoint(e,o)},hide:function(){this._hide()},addItem:function(t){return this.insertItem(t)},insertItem:function(t,e){e=void 0!==e?e:this._items.length;var o=this._createItem(this._container,t,e);return this._items.push(o),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:o.el,index:e}),o.el},removeItem:function(e){var o=this._container;return isNaN(e)||(e=o.children[e]),e?(this._removeItem(t.Util.stamp(e)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:e}),e):null},removeAllItems:function(){for(var e,o=this._container.children;o.length;)e=o[0],this._removeItem(t.Util.stamp(e));return o},hideAllItems:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._items[t].el.style.display="none"},showAllItems:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._items[t].el.style.display=""},setDisabled:function(e,o){var n=this._container,r=t.Map.ContextMenu.BASE_CLS+"-item";isNaN(e)||(e=n.children[e]),e&&t.DomUtil.hasClass(e,r)&&(o?(t.DomUtil.addClass(e,r+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:e})):(t.DomUtil.removeClass(e,r+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:e})))},isVisible:function(){return this._visible},_createItems:function(){var t,e,o=this._map.options.contextmenuItems;for(t=0,e=o.length;t<e;t++)this._items.push(this._createItem(this._container,o[t]))},_createItem:function(e,o,n){if(o.separator||"-"===o)return this._createSeparator(e,n);var r=t.Map.ContextMenu.BASE_CLS+"-item",i=o.disabled?r+" "+r+"-disabled":r,a=this._insertElementAt("a",i,e,n),s=this._createEventHandler(a,o.callback,o.context,o.hideOnSelect),l=this._getIcon(o),c=this._getIconCls(o),u="";return l?u='<img class="'+t.Map.ContextMenu.BASE_CLS+'-icon" src="'+l+'"/>':c&&(u='<span class="'+t.Map.ContextMenu.BASE_CLS+"-icon "+c+'"></span>'),a.innerHTML=u+o.text,a.href="#",t.DomEvent.on(a,"mouseover",this._onItemMouseOver,this).on(a,"mouseout",this._onItemMouseOut,this).on(a,"mousedown",t.DomEvent.stopPropagation).on(a,"click",s),t.Browser.touch&&t.DomEvent.on(a,this._touchstart,t.DomEvent.stopPropagation),t.Browser.pointer||t.DomEvent.on(a,"click",this._onItemMouseOut,this),{id:t.Util.stamp(a),el:a,callback:s}},_removeItem:function(e){var o,n,r,i,a;for(r=0,i=this._items.length;r<i;r++)if((o=this._items[r]).id===e)return n=o.el,(a=o.callback)&&(t.DomEvent.off(n,"mouseover",this._onItemMouseOver,this).off(n,"mouseover",this._onItemMouseOut,this).off(n,"mousedown",t.DomEvent.stopPropagation).off(n,"click",a),t.Browser.touch&&t.DomEvent.off(n,this._touchstart,t.DomEvent.stopPropagation),t.Browser.pointer||t.DomEvent.on(n,"click",this._onItemMouseOut,this)),this._container.removeChild(n),this._items.splice(r,1),o;return null},_createSeparator:function(e,o){var n=this._insertElementAt("div",t.Map.ContextMenu.BASE_CLS+"-separator",e,o);return{id:t.Util.stamp(n),el:n}},_createEventHandler:function(e,o,n,r){var i=this,a=(this._map,t.Map.ContextMenu.BASE_CLS+"-item-disabled");r=void 0===r||r;return function(){if(!t.DomUtil.hasClass(e,a)){
var s=i._map,l=i._showLocation.containerPoint,c=s.containerPointToLayerPoint(l),u={containerPoint:l,layerPoint:c,latlng:s.layerPointToLatLng(c),relatedTarget:i._showLocation.relatedTarget};r&&i._hide(),o&&o.call(n||s,u),i._map.fire("contextmenu.select",{contextmenu:i,el:e})}}},_insertElementAt:function(t,e,o,n){var r,i=document.createElement(t);return i.className=e,void 0!==n&&(r=o.children[n]),r?o.insertBefore(i,r):o.appendChild(i),i},_show:function(t){this._showAtPoint(t.containerPoint,t)},_showAtPoint:function(e,o){if(this._items.length){this._map;var n=t.extend(o||{},{contextmenu:this});this._showLocation={containerPoint:e},o&&o.relatedTarget&&(this._showLocation.relatedTarget=o.relatedTarget),this._setPosition(e),this._visible||(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",n)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_getIcon:function(e){return t.Browser.retina&&e.retinaIcon||e.icon},_getIconCls:function(e){return t.Browser.retina&&e.retinaIconCls||e.iconCls},_setPosition:function(e){var o,n=this._map.getSize(),r=this._container,i=this._getElementSize(r);this._map.options.contextmenuAnchor&&(o=t.point(this._map.options.contextmenuAnchor),e=e.add(o)),r._leaflet_pos=e,e.x+i.x>n.x?(r.style.left="auto",r.style.right=Math.min(Math.max(n.x-e.x,0),n.x-i.x-1)+"px"):(r.style.left=Math.max(e.x,0)+"px",r.style.right="auto"),e.y+i.y>n.y?(r.style.top="auto",r.style.bottom=Math.min(Math.max(n.y-e.y,0),n.y-i.y-1)+"px"):(r.style.top=Math.max(e.y,0)+"px",r.style.bottom="auto")},_getElementSize:function(t){var e=this._size,o=t.style.display;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display=o,this._sizeChanged=!1),e},_onKeyDown:function(t){27===t.keyCode&&this._hide()},_onItemMouseOver:function(e){t.DomUtil.addClass(e.target||e.srcElement,"over")},_onItemMouseOut:function(e){t.DomUtil.removeClass(e.target||e.srcElement,"over")}}),t.Map.addInitHook("addHandler","contextmenu",t.Map.ContextMenu),t.Mixin.ContextMenu={bindContextMenu:function(e){return t.setOptions(this,e),this._initContextMenu(),this},unbindContextMenu:function(){return this.off("contextmenu",this._showContextMenu,this),this},addContextMenuItem:function(t){this.options.contextmenuItems.push(t)},removeContextMenuItemWithIndex:function(t){for(var e=[],o=0;o<this.options.contextmenuItems.length;o++)this.options.contextmenuItems[o].index==t&&e.push(o);for(var n=e.pop();void 0!==n;)this.options.contextmenuItems.splice(n,1),n=e.pop()},replaceContextMenuItem:function(t){this.removeContextMenuItemWithIndex(t.index),this.addContextMenuItem(t)},_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(e){var o,n,r,i,a;if(this._map.contextmenu){for(n=t.extend({relatedTarget:this},e),r=this._map.mouseEventToContainerPoint(e.originalEvent),this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems(),i=0,a=this.options.contextmenuItems.length;i<a;i++)o=this.options.contextmenuItems[i],this._items.push(this._map.contextmenu.insertItem(o,o.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(r,n)}},_hideContextMenu:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._map.contextmenu.removeItem(this._items[t]);this._items.length=0,this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var e,o,n,r=[t.Marker,t.Path],i={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0};for(o=0,n=r.length;o<n;o++)(e=r[o]).prototype.options?e.mergeOptions(i):e.prototype.options=i,e.addInitHook((function(){this.options.contextmenu&&this._initContextMenu()})),e.include(t.Mixin.ContextMenu);return t.Map.ContextMenu})),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Qs=t()}}((function(){return function(){function t(e,o,n){function r(a,s){if(!o[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[a]={exports:{}};e[a][0].call(u.exports,(function(t){return r(e[a][1][t]||t)}),u,u.exports,t,e,o,n)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}return t}()({1:[function(t,e){"use strict";var o=String.prototype.replace,n=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports={default:r.RFC3986,formatters:{RFC1738:function(t){return o.call(t,n,"+")},RFC3986:function(t){return String(t)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986}},{}],2:[function(t,e){"use strict";var o=t(4),n=t(3),r=t(1);e.exports={formats:r,parse:n,stringify:o}},{1:1,3:3,4:4}],3:[function(t,e){"use strict";var o=t(5),n=Object.prototype.hasOwnProperty,r=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!0,decoder:o.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},s=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},l="utf8=%26%2310003%3B",c="utf8=%E2%9C%93",u=function(t,e){var u,p={__proto__:null},d=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,f=e.parameterLimit===1/0?void 0:e.parameterLimit,h=d.split(e.delimiter,f),m=-1,y=e.charset;if(e.charsetSentinel)for(u=0;u<h.length;++u)0===h[u].indexOf("utf8=")&&(h[u]===c?y="utf-8":h[u]===l&&(y="iso-8859-1"),m=u,u=h.length);for(u=0;u<h.length;++u)if(u!==m){var g,v,b=h[u],_=b.indexOf("]="),w=-1===_?b.indexOf("="):_+1;-1===w?(g=e.decoder(b,i.decoder,y,"key"),v=e.strictNullHandling?null:""):(g=e.decoder(b.slice(0,w),i.decoder,y,"key"),v=o.maybeMap(s(b.slice(w+1),e),(function(t){return e.decoder(t,i.decoder,y,"value")}))),v&&e.interpretNumericEntities&&"iso-8859-1"===y&&(v=a(v)),b.indexOf("[]=")>-1&&(v=r(v)?[v]:v);var S=n.call(p,g);S&&"combine"===e.duplicates?p[g]=o.combine(p[g],v):S&&"last"!==e.duplicates||(p[g]=v)}return p},p=function(t,e,o,n){for(var r=n?e:s(e,o),i=t.length-1;i>=0;--i){var a,l=t[i];if("[]"===l&&o.parseArrays)a=o.allowEmptyArrays&&""===r?[]:[].concat(r);else{a=o.plainObjects?Object.create(null):{};var c="["===l.charAt(0)&&"]"===l.charAt(l.length-1)?l.slice(1,-1):l,u=o.decodeDotInKeys?c.replace(/%2E/g,"."):c,p=parseInt(u,10);o.parseArrays||""!==u?!isNaN(p)&&l!==u&&String(p)===u&&p>=0&&o.parseArrays&&p<=o.arrayLimit?(a=[])[p]=r:"__proto__"!==u&&(a[u]=r):a={0:r}}r=a}return r},d=function(t,e,o,r){if(t){var i=o.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,a=/(\[[^[\]]*])/g,s=o.depth>0&&/(\[[^[\]]*])/.exec(i),l=s?i.slice(0,s.index):i,c=[];if(l){if(!o.plainObjects&&n.call(Object.prototype,l)&&!o.allowPrototypes)return;c.push(l)}for(var u=0;o.depth>0&&null!==(s=a.exec(i))&&u<o.depth;){if(u+=1,!o.plainObjects&&n.call(Object.prototype,s[1].slice(1,-1))&&!o.allowPrototypes)return;c.push(s[1])}return s&&c.push("["+i.slice(s.index)+"]"),p(c,e,o,r)}},f=function(t){if(!t)return i;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.decodeDotInKeys&&"boolean"!=typeof t.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?i.charset:t.charset,n=void 0===t.duplicates?i.duplicates:t.duplicates;if("combine"!==n&&"first"!==n&&"last"!==n)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===t.allowDots?!0===t.decodeDotInKeys||i.allowDots:!!t.allowDots,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:i.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:i.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:i.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:i.comma,decodeDotInKeys:"boolean"==typeof t.decodeDotInKeys?t.decodeDotInKeys:i.decodeDotInKeys,decoder:"function"==typeof t.decoder?t.decoder:i.decoder,delimiter:"string"==typeof t.delimiter||o.isRegExp(t.delimiter)?t.delimiter:i.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:i.depth,duplicates:n,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:i.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:i.strictNullHandling}};e.exports=function(t,e){var n=f(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof t?u(t,n):t,i=n.plainObjects?Object.create(null):{},a=Object.keys(r),s=0;s<a.length;++s){var l=a[s],c=d(l,r[l],n,"string"==typeof t);i=o.merge(i,c,n)}return!0===n.allowSparse?i:o.compact(i)}},{5:5}],4:[function(t,e){"use strict";var o=t(29),n=t(5),r=t(1),i=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},s=Array.isArray,l=Array.prototype.push,c=function(t,e){l.apply(t,s(e)?e:[e])},u=Date.prototype.toISOString,p=r.default,d={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:n.encode,encodeValuesOnly:!1,format:p,formatter:r.formatters[p],indices:!1,serializeDate:function(t){return u.call(t)},skipNulls:!1,strictNullHandling:!1},f=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t},h={},m=function t(e,r,i,a,l,u,p,m,y,g,v,b,_,w,S,x,O,M){for(var $=e,L=M,E=0,k=!1;void 0!==(L=L.get(h))&&!k;){var C=L.get(e);if(E+=1,void 0!==C){if(C===E)throw new RangeError("Cyclic object value");k=!0}void 0===L.get(h)&&(E=0)}if("function"==typeof g?$=g(r,$):$ instanceof Date?$=_($):"comma"===i&&s($)&&($=n.maybeMap($,(function(t){return t instanceof Date?_(t):t}))),null===$){if(u)return y&&!x?y(r,d.encoder,O,"key",w):r;$=""}if(f($)||n.isBuffer($))return y?[S(x?r:y(r,d.encoder,O,"key",w))+"="+S(y($,d.encoder,O,"value",w))]:[S(r)+"="+S(String($))];var I,j=[];if(void 0===$)return j;if("comma"===i&&s($))x&&y&&($=n.maybeMap($,y)),I=[{value:$.length>0?$.join(",")||null:void 0}];else if(s(g))I=g;else{var A=Object.keys($);I=v?A.sort(v):A}var P=m?r.replace(/\./g,"%2E"):r,T=a&&s($)&&1===$.length?P+"[]":P;if(l&&s($)&&0===$.length)return T+"[]";for(var D=0;D<I.length;++D){var F=I[D],B="object"==typeof F&&void 0!==F.value?F.value:$[F];if(!p||null!==B){var R=b&&m?F.replace(/\./g,"%2E"):F,U=s($)?"function"==typeof i?i(T,R):T:T+(b?"."+R:"["+R+"]");M.set(e,E);var N=o();N.set(h,M),c(j,t(B,U,i,a,l,u,p,m,"comma"===i&&x&&s($)?null:y,g,v,b,_,w,S,x,O,N))}}return j},y=function(t){if(!t)return d;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.encodeDotInKeys&&"boolean"!=typeof t.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||d.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var o=r.default;if(void 0!==t.format){if(!i.call(r.formatters,t.format))throw new TypeError("Unknown format option provided.");o=t.format}var n,l=r.formatters[o],c=d.filter;if(("function"==typeof t.filter||s(t.filter))&&(c=t.filter),n=t.arrayFormat in a?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":d.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var u=void 0===t.allowDots?!0===t.encodeDotInKeys||d.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:d.addQueryPrefix,allowDots:u,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:d.allowEmptyArrays,arrayFormat:n,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:d.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:void 0===t.delimiter?d.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:d.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:d.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:d.encodeValuesOnly,filter:c,format:o,formatter:l,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:d.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:d.strictNullHandling}};e.exports=function(t,e){var n,r=t,i=y(e);"function"==typeof i.filter?r=(0,i.filter)("",r):s(i.filter)&&(n=i.filter);var l=[];if("object"!=typeof r||null===r)return"";var u=a[i.arrayFormat],p="comma"===u&&i.commaRoundTrip;n||(n=Object.keys(r)),i.sort&&n.sort(i.sort);for(var d=o(),f=0;f<n.length;++f){var h=n[f];i.skipNulls&&null===r[h]||c(l,m(r[h],h,u,p,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,d))}var g=l.join(i.delimiter),v=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),g.length>0?v+g:""}},{1:1,29:29,5:5}],5:[function(t,e){"use strict";var o=t(1),n=Object.prototype.hasOwnProperty,r=Array.isArray,i=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t){for(;t.length>1;){var e=t.pop(),o=e.obj[e.prop];if(r(o)){for(var n=[],i=0;i<o.length;++i)void 0!==o[i]&&n.push(o[i]);e.obj[e.prop]=n}}},s=function(t,e){for(var o=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(o[n]=t[n]);return o},l=function t(e,o,i){if(!o)return e;if("object"!=typeof o){if(r(e))e.push(o);else{if(!e||"object"!=typeof e)return[e,o];(i&&(i.plainObjects||i.allowPrototypes)||!n.call(Object.prototype,o))&&(e[o]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(o);var a=e;return r(e)&&!r(o)&&(a=s(e,i)),r(e)&&r(o)?(o.forEach((function(o,r){if(n.call(e,r)){var a=e[r];a&&"object"==typeof a&&o&&"object"==typeof o?e[r]=t(a,o,i):e.push(o)}else e[r]=o})),e):Object.keys(o).reduce((function(e,r){var a=o[r];return n.call(e,r)?e[r]=t(e[r],a,i):e[r]=a,e}),a)},c=function(t,e,o){var n=t.replace(/\+/g," ");if("iso-8859-1"===o)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},u=function(t,e,n,r,a){if(0===t.length)return t;var s=t;if("symbol"==typeof t?s=Symbol.prototype.toString.call(t):"string"!=typeof t&&(s=String(t)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var l="",c=0;c<s.length;++c){var u=s.charCodeAt(c);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||a===o.RFC1738&&(40===u||41===u)?l+=s.charAt(c):u<128?l+=i[u]:u<2048?l+=i[192|u>>6]+i[128|63&u]:u<55296||u>=57344?l+=i[224|u>>12]+i[128|u>>6&63]+i[128|63&u]:(c+=1,u=65536+((1023&u)<<10|1023&s.charCodeAt(c)),l+=i[240|u>>18]+i[128|u>>12&63]+i[128|u>>6&63]+i[128|63&u])}return l},p=function(t){for(var e=[{obj:{o:t},prop:"o"}],o=[],n=0;n<e.length;++n)for(var r=e[n],i=r.obj[r.prop],s=Object.keys(i),l=0;l<s.length;++l){var c=s[l],u=i[c];"object"==typeof u&&null!==u&&-1===o.indexOf(u)&&(e.push({obj:i,prop:c}),o.push(u))}return a(e),t},d=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},f=function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},h=function(t,e){return[].concat(t,e)},m=function(t,e){if(r(t)){for(var o=[],n=0;n<t.length;n+=1)o.push(e(t[n]));return o}return e(t)};e.exports={combine:h,compact:p,decode:c,encode:u,isBuffer:f,isRegExp:d,maybeMap:m,merge:l}},{1:1}],29:[function(t,e){"use strict";var o=t(20),n=t(7),r=t(27),i=t(16),a=o("%WeakMap%",!0),s=o("%Map%",!0),l=n("WeakMap.prototype.get",!0),c=n("WeakMap.prototype.set",!0),u=n("WeakMap.prototype.has",!0),p=n("Map.prototype.get",!0),d=n("Map.prototype.set",!0),f=n("Map.prototype.has",!0),h=function(t,e){for(var o,n=t;null!==(o=n.next);n=o)if(o.key===e)return n.next=o.next,o.next=t.next,t.next=o,o},m=function(t,e){var o=h(t,e);return o&&o.value},y=function(t,e,o){var n=h(t,e);n?n.value=o:t.next={key:e,next:t.next,value:o}},g=function(t,e){return!!h(t,e)};e.exports=function(){var t,e,o,n={assert:function(t){if(!n.has(t))throw new i("Side channel does not contain "+r(t))},get:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return l(t,n)}else if(s){if(e)return p(e,n)}else if(o)return m(o,n)},has:function(n){if(a&&n&&("object"==typeof n||"function"==typeof n)){if(t)return u(t,n)}else if(s){if(e)return f(e,n)}else if(o)return g(o,n);return!1},set:function(n,r){a&&n&&("object"==typeof n||"function"==typeof n)?(t||(t=new a),c(t,n,r)):s?(e||(e=new s),d(e,n,r)):(o||(o={key:{},next:null}),y(o,n,r))}};return n}},{16:16,20:20,27:27,7:7}],6:[function(){},{}],7:[function(t,e){"use strict";var o=t(20),n=t(8),r=n(o("String.prototype.indexOf"));e.exports=function(t,e){var i=o(t,!!e);return"function"==typeof i&&r(t,".prototype.")>-1?n(i):i}},{20:20,8:8}],20:[function(t,e){"use strict";var o,n=t(12),r=t(11),i=t(13),a=t(14),s=t(15),l=t(16),c=t(17),u=Function,p=function(t){try{return u('"use strict"; return ('+t+").constructor;")()}catch(t){}},d=Object.getOwnPropertyDescriptor;if(d)try{d({},"")}catch(t){d=null}var f=function(){throw new l},h=d?function(){try{return f}catch(t){try{return d(arguments,"callee").get}catch(t){return f}}}():f,m=t(24)(),y=t(23)(),g=Object.getPrototypeOf||(y?function(t){return t.__proto__}:null),v={},b="undefined"!=typeof Uint8Array&&g?g(Uint8Array):o,_={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?o:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?o:ArrayBuffer,"%ArrayIteratorPrototype%":m&&g?g([][Symbol.iterator]()):o,"%AsyncFromSyncIteratorPrototype%":o,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?o:Atomics,"%BigInt%":"undefined"==typeof BigInt?o:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?o:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?o:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?o:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":r,"%Float32Array%":"undefined"==typeof Float32Array?o:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?o:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?o:FinalizationRegistry,"%Function%":u,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?o:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?o:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?o:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":m&&g?g(g([][Symbol.iterator]())):o,"%JSON%":"object"==typeof JSON?JSON:o,"%Map%":"undefined"==typeof Map?o:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&m&&g?g((new Map)[Symbol.iterator]()):o,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?o:Promise,"%Proxy%":"undefined"==typeof Proxy?o:Proxy,"%RangeError%":i,"%ReferenceError%":a,"%Reflect%":"undefined"==typeof Reflect?o:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?o:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&m&&g?g((new Set)[Symbol.iterator]()):o,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?o:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":m&&g?g(""[Symbol.iterator]()):o,"%Symbol%":m?Symbol:o,"%SyntaxError%":s,"%ThrowTypeError%":h,"%TypedArray%":b,"%TypeError%":l,"%Uint8Array%":"undefined"==typeof Uint8Array?o:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?o:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?o:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?o:Uint32Array,"%URIError%":c,"%WeakMap%":"undefined"==typeof WeakMap?o:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?o:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?o:WeakSet};if(g)try{null.error}catch(t){var w=g(g(t));_["%Error.prototype%"]=w}var S=function t(e){var o;if("%AsyncFunction%"===e)o=p("async function () {}");else if("%GeneratorFunction%"===e)o=p("function* () {}");else if("%AsyncGeneratorFunction%"===e)o=p("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(o=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&g&&(o=g(r.prototype))}return _[e]=o,o},x={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},O=t(19),M=t(26),$=O.call(Function.call,Array.prototype.concat),L=O.call(Function.apply,Array.prototype.splice),E=O.call(Function.call,String.prototype.replace),k=O.call(Function.call,String.prototype.slice),C=O.call(Function.call,RegExp.prototype.exec),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,j=/\\(\\)?/g,A=function(t){var e=k(t,0,1),o=k(t,-1);if("%"===e&&"%"!==o)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===o&&"%"!==e)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return E(t,I,(function(t,e,o,r){n[n.length]=o?E(r,j,"$1"):e||t})),n},P=function(t,e){var o,n=t;if(M(x,n)&&(n="%"+(o=x[n])[0]+"%"),M(_,n)){var r=_[n];if(r===v&&(r=S(n)),void 0===r&&!e)throw new l("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:o,name:n,value:r}}throw new s("intrinsic "+t+" does not exist!")};e.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new l("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new l('"allowMissing" argument must be a boolean');if(null===C(/^%?[^%]*%?$/,t))throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var o=A(t),n=o.length>0?o[0]:"",r=P("%"+n+"%",e),i=r.name,a=r.value,c=!1,u=r.alias;u&&(n=u[0],L(o,$([0,1],u)));for(var p=1,f=!0;p<o.length;p+=1){var h=o[p],m=k(h,0,1),y=k(h,-1);if(('"'===m||"'"===m||"`"===m||'"'===y||"'"===y||"`"===y)&&m!==y)throw new s("property names with quotes must have matching quotes");if("constructor"!==h&&f||(c=!0),M(_,i="%"+(n+="."+h)+"%"))a=_[i];else if(null!=a){if(!(h in a)){if(!e)throw new l("base intrinsic for "+t+" exists, but the property is not available.");return}if(d&&p+1>=o.length){var g=d(a,h);a=(f=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:a[h]}else f=M(a,h),a=a[h];f&&!c&&(_[i]=a)}}return a}},{11:11,12:12,13:13,14:14,15:15,16:16,17:17,19:19,23:23,24:24,26:26}],8:[function(t,e){"use strict";var o=t(19),n=t(20),r=t(28),i=t(16),a=n("%Function.prototype.apply%"),s=n("%Function.prototype.call%"),l=n("%Reflect.apply%",!0)||o.call(s,a),c=t(10),u=n("%Math.max%");e.exports=function(t){if("function"!=typeof t)throw new i("a function is required");var e=l(o,s,arguments);return r(e,1+u(0,t.length-(arguments.length-1)),!0)};var p=function(){return l(o,a,arguments)};c?c(e.exports,"apply",{value:p}):e.exports.apply=p},{10:10,16:16,19:19,20:20,28:28}],16:[function(t,e){"use strict";e.exports=TypeError},{}],19:[function(t,e){"use strict";var o=t(18);e.exports=Function.prototype.bind||o},{18:18}],10:[function(t,e){"use strict";var o=t(20)("%Object.defineProperty%",!0)||!1;if(o)try{o({},"a",{value:1})}catch(t){o=!1}e.exports=o},{20:20}],28:[function(t,e){"use strict";var o=t(20),n=t(9),r=t(22)(),i=t(21),a=t(16),s=o("%Math.floor%");e.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||s(e)!==e)throw new a("`length` must be a positive 32-bit integer");var o=arguments.length>2&&!!arguments[2],l=!0,c=!0;if("length"in t&&i){var u=i(t,"length");u&&!u.configurable&&(l=!1),u&&!u.writable&&(c=!1)}return(l||c||!o)&&(r?n(t,"length",e,!0,!0):n(t,"length",e)),t}},{16:16,20:20,21:21,22:22,9:9}],9:[function(t,e){"use strict";var o=t(10),n=t(15),r=t(16),i=t(21);e.exports=function(t,e,a){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new r("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new r("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],p=!!i&&i(t,e);if(o)o(t,e,{configurable:null===c&&p?p.configurable:!c,enumerable:null===s&&p?p.enumerable:!s,value:a,writable:null===l&&p?p.writable:!l});else{if(!u&&(s||l||c))throw new n("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=a}}},{10:10,15:15,16:16,21:21}],15:[function(t,e){"use strict";e.exports=SyntaxError},{}],21:[function(t,e){"use strict";var o=t(20)("%Object.getOwnPropertyDescriptor%",!0);if(o)try{o([],"length")}catch(t){o=null}e.exports=o},{20:20}],11:[function(t,e){"use strict";e.exports=EvalError},{}],12:[function(t,e){"use strict";e.exports=Error},{}],13:[function(t,e){"use strict";e.exports=RangeError},{}],14:[function(t,e){"use strict";e.exports=ReferenceError},{}],17:[function(t,e){"use strict";e.exports=URIError},{}],18:[function(t,e){"use strict";var o="Function.prototype.bind called on incompatible ",n=Object.prototype.toString,r=Math.max,i="[object Function]",a=function(t,e){for(var o=[],n=0;n<t.length;n+=1)o[n]=t[n];for(var r=0;r<e.length;r+=1)o[r+t.length]=e[r];return o},s=function(t,e){for(var o=[],n=e||0,r=0;n<t.length;n+=1,r+=1)o[r]=t[n];return o},l=function(t,e){for(var o="",n=0;n<t.length;n+=1)o+=t[n],n+1<t.length&&(o+=e);return o};e.exports=function(t){var e=this;if("function"!=typeof e||n.apply(e)!==i)throw new TypeError(o+e);for(var c,u=s(arguments,1),p=r(0,e.length-u.length),d=[],f=0;f<p;f++)d[f]="$"+f;if(c=Function("binder","return function ("+l(d,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof c){var o=e.apply(this,a(u,arguments));return Object(o)===o?o:this}return e.apply(t,a(u,arguments))})),e.prototype){var h=function(){};h.prototype=e.prototype,c.prototype=new h,h.prototype=null}return c}},{}],23:[function(t,e){"use strict";var o={__proto__:null,foo:{}},n=Object;e.exports=function(){return{__proto__:o}.foo===o.foo&&!(o instanceof n)}},{}],26:[function(t,e){"use strict";var o=Function.prototype.call,n=Object.prototype.hasOwnProperty,r=t(19);e.exports=r.call(o,n)},{19:19}],24:[function(t,e){"use strict";var o="undefined"!=typeof Symbol&&Symbol,n=t(25);e.exports=function(){return"function"==typeof o&&"function"==typeof Symbol&&"symbol"==typeof o("foo")&&"symbol"==typeof Symbol("bar")&&n()}},{25:25}],22:[function(t,e){"use strict";var o=t(10),n=function(){return!!o};n.hasArrayLengthDefineBug=function(){if(!o)return null;try{return 1!==o([],"length",{value:1}).length}catch(t){return!0}},e.exports=n},{10:10}],25:[function(t,e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),o=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(o))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(t,e);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},{}],27:[function(t,e){(function(o){(function(){function n(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||X.call(/e/,e))return e;var o=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g
;if("number"==typeof t){var n=t<0?-nt(-t):nt(t);if(n!==t){var r=String(n),i=Z.call(e,r.length+1);return Q.call(r,o,"$&_")+"."+Q.call(Q.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Q.call(e,o,"$&_")}function r(t,e,o){var n="double"===(o.quoteStyle||e)?'"':"'";return n+t+n}function i(t){return Q.call(String(t),/"/g,"&quot;")}function a(t){return!("[object Array]"!==y(t)||lt&&"object"==typeof t&&lt in t)}function s(t){return!("[object Date]"!==y(t)||lt&&"object"==typeof t&&lt in t)}function l(t){return!("[object RegExp]"!==y(t)||lt&&"object"==typeof t&&lt in t)}function c(t){return!("[object Error]"!==y(t)||lt&&"object"==typeof t&&lt in t)}function u(t){return!("[object String]"!==y(t)||lt&&"object"==typeof t&&lt in t)}function p(t){return!("[object Number]"!==y(t)||lt&&"object"==typeof t&&lt in t)}function d(t){return!("[object Boolean]"!==y(t)||lt&&"object"==typeof t&&lt in t)}function f(t){if(st)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!at)return!1;try{return at.call(t),!0}catch(t){}return!1}function h(t){if(!t||"object"!=typeof t||!rt)return!1;try{return rt.call(t),!0}catch(t){}return!1}function m(t,e){return ht.call(t,e)}function y(t){return K.call(t)}function g(t){if(t.name)return t.name;var e=W.call(G.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function v(t,e){if(t.indexOf)return t.indexOf(e);for(var o=0,n=t.length;o<n;o++)if(t[o]===e)return o;return-1}function b(t){if(!D||!t||"object"!=typeof t)return!1;try{D.call(t);try{U.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}function _(t){if(!z||!t||"object"!=typeof t)return!1;try{z.call(t,z);try{q.call(t,q)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}function w(t){if(!H||!t||"object"!=typeof t)return!1;try{return H.call(t),!0}catch(t){}return!1}function S(t){if(!U||!t||"object"!=typeof t)return!1;try{U.call(t);try{D.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}function x(t){if(!q||!t||"object"!=typeof t)return!1;try{q.call(t,q);try{z.call(t,z)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}function O(t){return!(!t||"object"!=typeof t)&&("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||"string"==typeof t.nodeName&&"function"==typeof t.getAttribute)}function M(t,e){if(t.length>e.maxStringLength){var o=t.length-e.maxStringLength,n="... "+o+" more character"+(o>1?"s":"");return M(Z.call(t,0,e.maxStringLength),e)+n}return r(Q.call(Q.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,$),"single",e)}function $(t){var e=t.charCodeAt(0),o={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return o?"\\"+o:"\\x"+(e<16?"0":"")+Y.call(e.toString(16))}function L(t){return"Object("+t+")"}function E(t){return t+" { ? }"}function k(t,e,o,n){return t+" ("+e+") {"+(n?j(o,n):et.call(o,", "))+"}"}function C(t){for(var e=0;e<t.length;e++)if(v(t[e],"\n")>=0)return!1;return!0}function I(t,e){var o;if("\t"===t.indent)o="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;o=et.call(Array(t.indent+1)," ")}return{base:o,prev:et.call(Array(e+1),o)}}function j(t,e){if(0===t.length)return"";var o="\n"+e.prev+e.base;return o+et.call(t,","+o)+"\n"+e.prev}function A(t,e){var o=a(t),n=[];if(o){n.length=t.length;for(var r=0;r<t.length;r++)n[r]=m(t,r)?e(t[r],t):""}var i,s="function"==typeof it?it(t):[];if(st){i={};for(var l=0;l<s.length;l++)i["$"+s[l]]=s[l]}for(var c in t)m(t,c)&&(o&&String(Number(c))===c&&c<t.length||st&&i["$"+c]instanceof Symbol||(X.call(/[^\w$]/,c)?n.push(e(c,t)+": "+e(t[c],t)):n.push(c+": "+e(t[c],t))));if("function"==typeof it)for(var u=0;u<s.length;u++)ct.call(t,s[u])&&n.push("["+e(s[u])+"]: "+e(t[s[u]],t));return n}var P="function"==typeof Map&&Map.prototype,T=Object.getOwnPropertyDescriptor&&P?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,D=P&&T&&"function"==typeof T.get?T.get:null,F=P&&Map.prototype.forEach,B="function"==typeof Set&&Set.prototype,R=Object.getOwnPropertyDescriptor&&B?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,U=B&&R&&"function"==typeof R.get?R.get:null,N=B&&Set.prototype.forEach,z="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,q="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,H="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,V=Boolean.prototype.valueOf,K=Object.prototype.toString,G=Function.prototype.toString,W=String.prototype.match,Z=String.prototype.slice,Q=String.prototype.replace,Y=String.prototype.toUpperCase,J=String.prototype.toLowerCase,X=RegExp.prototype.test,tt=Array.prototype.concat,et=Array.prototype.join,ot=Array.prototype.slice,nt=Math.floor,rt="function"==typeof BigInt?BigInt.prototype.valueOf:null,it=Object.getOwnPropertySymbols,at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,st="function"==typeof Symbol&&"object"==typeof Symbol.iterator,lt="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,ct=Object.prototype.propertyIsEnumerable,ut=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null),pt=t(6),dt=pt.custom,ft=f(dt)?dt:null;e.exports=function t(e,$,P,T){function B(e,o,n){if(o&&(T=ot.call(T)).push(o),n){var r={depth:R.depth};return m(R,"quoteStyle")&&(r.quoteStyle=R.quoteStyle),t(e,r,P+1,T)}return t(e,R,P+1,T)}var R=$||{};if(m(R,"quoteStyle")&&"single"!==R.quoteStyle&&"double"!==R.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(m(R,"maxStringLength")&&("number"==typeof R.maxStringLength?R.maxStringLength<0&&R.maxStringLength!==1/0:null!==R.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var z=!m(R,"customInspect")||R.customInspect;if("boolean"!=typeof z&&"symbol"!==z)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(m(R,"indent")&&null!==R.indent&&"\t"!==R.indent&&!(parseInt(R.indent,10)===R.indent&&R.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(m(R,"numericSeparator")&&"boolean"!=typeof R.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var q=R.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return M(e,R);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var H=String(e);return q?n(e,H):H}if("bigint"==typeof e){var K=String(e)+"n";return q?n(e,K):K}var G=void 0===R.depth?5:R.depth;if(void 0===P&&(P=0),P>=G&&G>0&&"object"==typeof e)return a(e)?"[Array]":"[Object]";var W=I(R,P);if(void 0===T)T=[];else if(v(T,e)>=0)return"[Circular]";if("function"==typeof e&&!l(e)){var Y=g(e),X=A(e,B);return"[Function"+(Y?": "+Y:" (anonymous)")+"]"+(X.length>0?" { "+et.call(X,", ")+" }":"")}if(f(e)){var nt=st?Q.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):at.call(e);return"object"!=typeof e||st?nt:L(nt)}if(O(e)){for(var it="<"+J.call(String(e.nodeName)),dt=e.attributes||[],ht=0;ht<dt.length;ht++)it+=" "+dt[ht].name+"="+r(i(dt[ht].value),"double",R);return it+=">",e.childNodes&&e.childNodes.length&&(it+="..."),it+"</"+J.call(String(e.nodeName))+">"}if(a(e)){if(0===e.length)return"[]";var mt=A(e,B);return W&&!C(mt)?"["+j(mt,W)+"]":"[ "+et.call(mt,", ")+" ]"}if(c(e)){var yt=A(e,B);return"cause"in Error.prototype||!("cause"in e)||ct.call(e,"cause")?0===yt.length?"["+String(e)+"]":"{ ["+String(e)+"] "+et.call(yt,", ")+" }":"{ ["+String(e)+"] "+et.call(tt.call("[cause]: "+B(e.cause),yt),", ")+" }"}if("object"==typeof e&&z){if(ft&&"function"==typeof e[ft]&&pt)return pt(e,{depth:G-P});if("symbol"!==z&&"function"==typeof e.inspect)return e.inspect()}if(b(e)){var gt=[];return F&&F.call(e,(function(t,o){gt.push(B(o,e,!0)+" => "+B(t,e))})),k("Map",D.call(e),gt,W)}if(S(e)){var vt=[];return N&&N.call(e,(function(t){vt.push(B(t,e))})),k("Set",U.call(e),vt,W)}if(_(e))return E("WeakMap");if(x(e))return E("WeakSet");if(w(e))return E("WeakRef");if(p(e))return L(B(Number(e)));if(h(e))return L(B(rt.call(e)));if(d(e))return L(V.call(e));if(u(e))return L(B(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if(e===o)return"{ [object globalThis] }";if(!s(e)&&!l(e)){var bt=A(e,B),_t=ut?ut(e)===Object.prototype:e instanceof Object||e.constructor===Object,wt=e instanceof Object?"":"null prototype",St=!_t&&lt&&Object(e)===e&&lt in e?Z.call(y(e),8,-1):wt?"Object":"",xt=(_t||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(St||wt?"["+et.call(tt.call([],St||[],wt||[]),": ")+"] ":"");return 0===bt.length?xt+"{}":W?xt+"{"+j(bt,W)+"}":xt+"{ "+et.call(bt,", ")+" }"}return String(e)};var ht=Object.prototype.hasOwnProperty||function(t){return t in this}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{6:6}]},{},[2])(2)})),OSM.initializeContextMenu=function(t){t.contextmenu.addItem({text:I18n.t("javascripts.context.directions_from"),callback:function(e){var o=OSM.zoomPrecision(t.getZoom()),n=e.latlng.wrap(),r=n.lat.toFixed(o),i=n.lng.toFixed(o);OSM.router.route("/directions?"+Qs.stringify({from:r+","+i,to:$("#route_to").val()}))}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.directions_to"),callback:function(e){var o=OSM.zoomPrecision(t.getZoom()),n=e.latlng.wrap(),r=n.lat.toFixed(o),i=n.lng.toFixed(o);OSM.router.route("/directions?"+Qs.stringify({from:$("#route_from").val(),to:r+","+i}))}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.add_note"),callback:function(e){var o=OSM.zoomPrecision(t.getZoom()),n=e.latlng.wrap(),r=n.lat.toFixed(o),i=n.lng.toFixed(o);OSM.router.route("/note/new?lat="+r+"&lon="+i)}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.show_address"),callback:function(e){var o=OSM.zoomPrecision(t.getZoom()),n=e.latlng.wrap(),r=n.lat.toFixed(o),i=n.lng.toFixed(o);OSM.router.route("/search?whereami=1&query="+encodeURIComponent(r+","+i))}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.query_features"),callback:function(e){var o=OSM.zoomPrecision(t.getZoom()),n=e.latlng.wrap(),r=n.lat.toFixed(o),i=n.lng.toFixed(o);OSM.router.route("/query?lat="+r+"&lon="+i)}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.centre_map"),callback:function(e){t.panTo(e.latlng)}}),t.on("mousedown",(function(e){e.originalEvent.shiftKey?t.contextmenu.disable():t.contextmenu.enable()}));var e=function(){t.contextmenu.setDisabled(2,t.getZoom()<12),t.contextmenu.setDisabled(4,t.getZoom()<14)};t.on("zoomend",e),e()},function(t,e){function o(e){var o,n=t(e.ownerDocument);return{x:(o=(e=t(e)).offset()).left+e.outerWidth()/2-n.scrollLeft(),y:o.top+e.outerHeight()/2-n.scrollTop()}}function n(e){var o,n=t(e.ownerDocument);return{x:(o=(e=t(e)).offset()).left-n.scrollLeft(),y:o.top-n.scrollTop()}}var r=/^key/,i=/^(?:mouse|contextmenu)|click/;t.fn.simulate=function(e,o){return this.each((function(){new t.simulate(this,e,o)}))},t.simulate=function(e,o,n){var r=t.camelCase("simulate-"+o);this.target=e,this.options=n,this[r]?this[r]():this.simulateEvent(e,o,n)},t.extend(t.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}}),t.extend(t.simulate.prototype,{simulateEvent:function(t,e,o){var n=this.createEvent(e,o);this.dispatchEvent(t,e,n,o)},createEvent:function(t,e){return r.test(t)?this.keyEvent(t,e):i.test(t)?this.mouseEvent(t,e):void 0},mouseEvent:function(o,n){var r,i,a,s;return n=t.extend({bubbles:!0,cancelable:"mousemove"!==o,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:e},n),document.createEvent?((r=document.createEvent("MouseEvents")).initMouseEvent(o,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget||document.body.parentNode),0===r.pageX&&0===r.pageY&&Object.defineProperty&&(i=r.relatedTarget.ownerDocument||document,a=i.documentElement,s=i.body,Object.defineProperty(r,"pageX",{get:function(){return n.clientX+(a&&a.scrollLeft||s&&s.scrollLeft||0)-(a&&a.clientLeft||s&&s.clientLeft||0)}}),Object.defineProperty(r,"pageY",{get:function(){return n.clientY+(a&&a.scrollTop||s&&s.scrollTop||0)-(a&&a.clientTop||s&&s.clientTop||0)}}))):document.createEventObject&&(r=document.createEventObject(),t.extend(r,n),r.button={0:1,1:4,2:2}[r.button]||(-1===r.button?0:r.button)),r},keyEvent:function(o,n){var r;if(n=t.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:e},n),document.createEvent)try{(r=document.createEvent("KeyEvents")).initKeyEvent(o,n.bubbles,n.cancelable,n.view,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode)}catch(e){(r=document.createEvent("Events")).initEvent(o,n.bubbles,n.cancelable),t.extend(r,{view:n.view,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,metaKey:n.metaKey,keyCode:n.keyCode,charCode:n.charCode})}else document.createEventObject&&(r=document.createEventObject(),t.extend(r,n));return(/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())||"[object Opera]"==={}.toString.call(window.opera))&&(r.keyCode=n.charCode>0?n.charCode:n.keyCode,r.charCode=e),r},dispatchEvent:function(t,e,o){t.dispatchEvent?t.dispatchEvent(o):"click"===e&&t.click&&"input"===t.nodeName.toLowerCase()?t.click():t.fireEvent&&t.fireEvent("on"+e,o)},simulateFocus:function(){function e(){n=!0}var o,n=!1,r=t(this.target);r.bind("focus",e),r[0].focus(),n||((o=t.Event("focusin")).preventDefault(),r.trigger(o),r.triggerHandler("focus")),r.unbind("focus",e)},simulateBlur:function(){function e(){n=!0}var o,n=!1,r=t(this.target);r.bind("blur",e),r[0].blur(),setTimeout((function(){r[0].ownerDocument.activeElement===r[0]&&r[0].ownerDocument.body.focus(),n||((o=t.Event("focusout")).preventDefault(),r.trigger(o),r.triggerHandler("blur")),r.unbind("blur",e)}),1)}}),t.extend(t.simulate.prototype,{simulateDrag:function(){var r=0,i=this.target,a=i.ownerDocument,s=this.options,l="corner"===s.handle?n(i):o(i),c=Math.floor(l.x),u=Math.floor(l.y),p={clientX:c,clientY:u},d=s.dx||(s.x!==e?s.x-c:0),f=s.dy||(s.y!==e?s.y-u:0),h=s.moves||3;for(this.simulateEvent(i,"mousedown",p);r<h;r++)c+=d/h,u+=f/h,p={clientX:Math.round(c),clientY:Math.round(u)},this.simulateEvent(a,"mousemove",p);t.contains(a,i)?(this.simulateEvent(i,"mouseup",p),this.simulateEvent(i,"click",p)):this.simulateEvent(a,"mouseup",p)}})}(jQuery),OSM.Search=function(t){function e(t){t.preventDefault(),t.stopPropagation();var e=$(this).parents(".search_more"),o=$("meta[name=csrf-param]").attr("content"),n=$("meta[name=csrf-token]").attr("content"),r={};$(this).hide(),e.find(".loader").show(),r[o]=n,$.ajax({url:$(this).attr("href"),method:"POST",data:r,success:function(t){e.replaceWith(t)}})}function o(){var t=$(this).data("marker");if(!t){var e=$(this).find("a.set_position").data();t=L.marker([e.lat,e.lon],{icon:OSM.getUserIcon()}),$(this).data("marker",t)}a.addLayer(t),$(this).closest("li").addClass("selected")}function n(){var t=$(this).data("marker");t&&a.removeLayer(t),$(this).closest("li").removeClass("selected")}function r(e){e.minLon&&e.minLat&&e.maxLon&&e.maxLat?t.fitBounds([[e.minLat,e.minLon],[e.maxLat,e.maxLon]]):t.setView([e.lat,e.lon],e.zoom)}function i(t){var e=$(this).data();r(e),e.type&&e.id||(t.preventDefault(),t.stopPropagation())}$(".search_form input[name=query]").on("input",(function(t){""===$(t.target).val()?$(".describe_location").fadeIn(100):$(".describe_location").fadeOut(100)})),$(".search_form a.button.switch_link").on("click",(function(e){e.preventDefault();var o=$(e.target).parent().parent().find("input[name=query]").val();o?OSM.router.route("/directions?from="+encodeURIComponent(o)+OSM.formatHash(t)):OSM.router.route("/directions"+OSM.formatHash(t))})),$(".search_form").on("submit",(function(e){e.preventDefault(),$("header").addClass("closed");var o=$(this).find("input[name=query]").val();o?OSM.router.route("/search?query="+encodeURIComponent(o)+OSM.formatHash(t)):OSM.router.route("/"+OSM.formatHash(t))})),$(".describe_location").on("click",(function(e){e.preventDefault();var o=t.getCenter().wrap(),n=OSM.zoomPrecision(t.getZoom());OSM.router.route("/search?whereami=1&query="+encodeURIComponent(o.lat.toFixed(n)+","+o.lng.toFixed(n)))})),$("#sidebar_content").on("click",".search_more a",e).on("click",".search_results_entry a.set_position",i).on("mouseover","li.search_results_entry:has(a.set_position)",o).on("mouseout","li.search_results_entry:has(a.set_position)",n).on("mousedown","li.search_results_entry:has(a.set_position)",(function(){var t=!1;$(this).one("click",(function(e){t||$(e.target).is("a")||$(this).find("a.set_position").simulate("click",e)})).one("mousemove",(function(){t=!0}))}));var a=L.layerGroup().addTo(t),s={};return s.pushstate=s.popstate=function(t){var e=Qs.parse(t.substring(t.indexOf("?")+1));$(".search_form input[name=query]").val(e.query),$(".describe_location").hide(),OSM.loadSidebarContent(t,s.load)},s.load=function(){return $(".search_results_entry").each((function(e){var o=$(this),n=$("meta[name=csrf-param]").attr("content"),i=$("meta[name=csrf-token]").attr("content"),a={zoom:t.getZoom(),minlon:t.getBounds().getWest(),minlat:t.getBounds().getSouth(),maxlon:t.getBounds().getEast(),maxlat:t.getBounds().getNorth()};a[n]=i,$.ajax({url:o.data("href"),method:"POST",data:a,success:function(t){if(o.html(t),0===e){var n=o.find("*[data-lat][data-lon]:first").first();n.length&&r(n.data())}}})})),t.getState()},s.unload=function(){a.clearLayers(),$(".search_form input[name=query]").val(""),$(".describe_location").fadeIn(100)},s},OSM.initializeBrowse=function(t){function e(){var e=t.getBounds();i&&i.contains(e)||n()}function o(t,e,o,n){$("#browse_status").html($("<div class='p-3'>").append($("<div class='d-flex'>").append($("<h2 class='flex-grow-1 text-break'>").text(I18n.t("browse.start_rjs.load_data")),$("<div>").append($("<button type='button' class='btn-close'>").attr("aria-label",I18n.t("javascripts.close")).click(n))),$("<p class='alert alert-warning'>").text(I18n.t("browse.start_rjs.feature_warning",{num_features:t,max_features:e})),$("<input type='submit' class='btn btn-primary'>").val(I18n.t("browse.start_rjs.load_data")).click(o)))}function n(){var e=t.getBounds(),n="/api/"+OSM.API_VERSION+"/map?bbox="+e.toBBoxString(),r=2e3;a&&a.abort(),a=$.ajax({url:n,success:function(n){function l(){$("#browse_status").empty(),s.addData(u),i=e}function c(){$("#browse_status").empty()}s.clearLayers();var u=s.buildFeatures(n);u.length<r?l():o(u.length,r,l,c),t._objectLayer&&t._objectLayer.bringToFront(),a=null}})}function r(t){OSM.router.route("/"+t.feature.type+"/"+t.feature.id)}var i,a,s=t.dataLayer;s.setStyle({way:{weight:3,color:"#000000",opacity:.4},area:{weight:3,color:"#ff0000"},node:{color:"#00ff00"}}),s.isWayArea=function(){return!1},s.on("click",(function(t){r(t.layer)})),t.on("layeradd",(function(o){o.layer===s&&(t.on("moveend",e),e())})),t.on("layerremove",(function(o){o.layer===s&&(t.off("moveend",e),$("#browse_status").empty())}))},OSM.Export=function(t){function e(){return L.latLngBounds(L.latLng($("#minlat").val(),$("#minlon").val()),L.latLng($("#maxlat").val(),$("#maxlon").val()))}function o(){var o=e();t.fitBounds(o),c.setBounds(o),c.enable(),a()}function n(e){e.preventDefault(),$("#drag_box").hide(),c.setBounds(t.getBounds().pad(-.2)),c.enable(),a()}function r(){i(c.isEnabled()?c.getBounds():t.getBounds()),a()}function i(e){var o=OSM.zoomPrecision(t.getZoom());$("#minlon").val(e.getWest().toFixed(o)),$("#minlat").val(e.getSouth().toFixed(o)),$("#maxlon").val(e.getEast().toFixed(o)),$("#maxlat").val(e.getNorth().toFixed(o)),$("#export_overpass").attr("href","https://overpass-api.de/api/map?bbox="+$("#minlon").val()+","+$("#minlat").val()+","+$("#maxlon").val()+","+$("#maxlat").val())}function a(){$("#export_osm_too_large").toggle(e().getSize()>OSM.MAX_REQUEST_AREA),$("#export_commit").toggle(e().getSize()<OSM.MAX_REQUEST_AREA)}function s(t){e().getSize()>OSM.MAX_REQUEST_AREA&&t.preventDefault()}var l={},c=new L.LocationFilter({enableButton:!1,adjustButton:!1}).on("change",r);return l.pushstate=l.popstate=function(t){OSM.loadSidebarContent(t,l.load)},l.load=function(){return t.addLayer(c).on("moveend",r),$("#maxlat, #minlon, #maxlon, #minlat").change(o),$("#drag_box").click(n),$(".export_form").on("submit",s),r(),t.getState()},l.unload=function(){t.removeLayer(c).off("moveend",r)},l},OSM.initializeNotes=function(t){function e(t,e){var o=t;return o?o.setIcon(a[e.properties.status]):((o=L.marker(e.geometry.coordinates.reverse(),{icon:a[e.properties.status],title:e.properties.comments[0].text,opacity:.8,interactive:!0})).id=e.properties.id,o.addTo(r)),o}function o(){function o(t){function o(t){var o=a[t.properties.id];delete a[t.properties.id],i[t.properties.id]=e(o,t)}var a=i;for(var s in i={},t.features.forEach(o),a)r.removeLayer(a[s]);n=null}var a=t.getBounds();if(a.getSize()<=OSM.MAX_NOTE_REQUEST_AREA){var s="/api/"+OSM.API_VERSION+"/notes.json?bbox="+a.toBBoxString();n&&n.abort(),n=$.ajax({url:s,success:o})}}var n,r=t.noteLayer,i={},a={new:L.icon({iconUrl:OSM.NEW_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),open:L.icon({iconUrl:OSM.OPEN_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),closed:L.icon({iconUrl:OSM.CLOSED_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]})};t.on("layeradd",(function(e){e.layer===r&&(o(),t.on("moveend",o))})).on("layerremove",(function(e){e.layer===r&&(t.off("moveend",o),r.clearLayers(),i={})})),r.on("click",(function(t){t.layer.id&&OSM.router.route("/note/"+t.layer.id)})),r.getLayerId=function(t){return t.id}},OSM.History=function(t){function e(t){var e=p.getLayer(t);e&&e.setStyle({fillOpacity:.3,color:"#FF6600",weight:3}),$("#changeset_"+t).addClass("selected")}function o(t){var e=p.getLayer(t);e&&e.setStyle({fillOpacity:0,color:"#FF9500",weight:2}),$("#changeset_"+t).removeClass("selected")}function n(t,e){$("#changeset_"+t).find("a.changeset_id").simulate("click",e)}function r(t){$("#sidebar_content .changesets").html(t)}function i(t){$("#sidebar_content .changeset_more").replaceWith(t);var e=$("#sidebar_content .changesets ol").first(),o=e.next("ol");o.children().appendTo(e),o.remove()}function a(){var e={list:"1"};if("/history"===window.location.pathname){e.bbox=t.getBounds().wrap().toBBoxString();var o=$('link[type="application/atom+xml"]'),n=o.attr("href").split("?")[0];o.attr("href",n+"?bbox="+e.bbox)}$.ajax({url:window.location.pathname,method:"GET",data:e,success:function(t){r(t),c()}})}function s(t){t.preventDefault(),t.stopPropagation();var e=$(this).parents(".changeset_more");$(this).hide(),e.find(".loader").show(),$.get($(this).attr("href"),(function(t){i(t),c()}))}function l(){p.clearLayers(),d.forEach((function(e){var o=t.project(L.latLng(e.bbox.minlat,e.bbox.minlon)),n=t.project(L.latLng(e.bbox.maxlat,e.bbox.maxlon)),r=n.x-o.x,i=o.y-n.y,a=20;r<a&&(o.x-=(a-r)/2,n.x+=(a-r)/2),i<a&&(o.y+=(a-i)/2,n.y-=(a-i)/2),e.bounds=L.latLngBounds(t.unproject(o),t.unproject(n))})),d.sort((function(t,e){return e.bounds.getSize()-t.bounds.getSize()}));for(var e=0;e<d.length;++e){var o=d[e],n=L.rectangle(o.bounds,{weight:2,color:"#FF9500",opacity:1,fillColor:"#FFFFAF",fillOpacity:0});n.id=o.id,n.addTo(p)}}function c(){if(d=$("[data-changeset]").map((function(t,e){return $(e).data("changeset")})).get().filter((function(t){return t.bbox})),l(),"/history"!==window.location.pathname){var e=p.getBounds();e.isValid()&&t.fitBounds(e)}}var u={};$("#sidebar_content").on("click",".changeset_more a",s).on("mouseover","[data-changeset]",(function(){e($(this).data("changeset").id)})).on("mouseout","[data-changeset]",(function(){o($(this).data("changeset").id)}));var p=L.featureGroup().on("mouseover",(function(t){e(t.layer.id)})).on("mouseout",(function(t){o(t.layer.id)})).on("click",(function(t){n(t.layer.id,t.originalEvent)}));p.getLayerId=function(t){return t.id};var d=[];return u.pushstate=u.popstate=function(t){OSM.loadSidebarContent(t,u.load)},u.load=function(){t.addLayer(p),"/history"===window.location.pathname&&t.on("moveend",a),t.on("zoomend",l),a()},u.unload=function(){t.removeLayer(p),t.off("moveend",a)},u},OSM.Note=function(t){function e(i,s,l){r.find("input[type=submit]").on("click",(function(t){t.preventDefault();var r=$(t.target).data(),a=t.target.form;$(a).find("input[type=submit]").prop("disabled",!0),$.ajax({url:r.url,type:r.method,oauth:!0,data:{text:$(a.text).val()},success:function(){OSM.loadSidebarContent(i,(function(){e(i,s,n)}))},error:function(t){$(a).find("#comment-error").text(t.responseText).prop("hidden",!1),o(a)}})})),r.find("textarea").on("input",(function(t){o(t.target.form)})),r.find("textarea").val("").trigger("input");var c=$(".details").data();c&&t.addObject({type:"note",id:parseInt(s,10),latLng:L.latLng(c.coordinates.split(",")),icon:a[c.status]}),l&&l()}function o(t){$(t).find("input[type=submit]").prop("disabled",!1),""===$(t.text).val()?($(t.close).val($(t.close).data("defaultActionText")),$(t.comment).prop("disabled",!0)):($(t.close).val($(t.close).data("commentActionText")),$(t.comment).prop("disabled",!1))}function n(){var e=$(".details").data();if(e){var o=L.latLng(e.coordinates.split(","));window.location.hash&&!window.location.hash.match(/^#?c[0-9]+$/)||OSM.router.withoutMoveListener((function(){t.setView(o,15,{reset:!0})}))}}var r=$("#sidebar_content"),i={},a={new:L.icon({iconUrl:OSM.NEW_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),open:L.icon({iconUrl:OSM.OPEN_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),closed:L.icon({iconUrl:OSM.CLOSED_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]})};return i.pushstate=i.popstate=function(o,r){OSM.loadSidebarContent(o,(function(){e(o,r,(function(){var e=$(".details").data();if(e){var o=L.latLng(e.coordinates.split(","));t.getBounds().contains(o)||n()}}))}))},i.load=function(t,o){e(t,o,n)},i.unload=function(){t.removeObject()},i},OSM.NewNote=function(t){function e(t,e,n){function i(t,e){s.find("textarea").val(""),o(t),r=null,a.removeLayer(e),c.removeClass("active"),OSM.router.route("/note/"+t.properties.id)}var l=t.getLatLng().wrap();t.options.draggable=!1,t.dragging.disable(),$(e).find("input[type=submit]").prop("disabled",!0),$.ajax({url:n,type:"POST",oauth:!0,data:{lat:l.lat,lon:l.lng,text:$(e.text).val()},success:function(e){i(e,t)}})}function o(t){var e=L.marker(t.geometry.coordinates.reverse(),{icon:u[t.properties.status],opacity:.9,interactive:!0});return e.id=t.properties.id,e.addTo(a),e}function n(e,o){var n=i&&t.hasLayer(i);"dragstart"===o&&n?t.removeLayer(i):(n&&t.removeLayer(i),i=L.circleMarker(e,{weight:2.5,radius:20,fillOpacity:.5,color:"#FF6200"}),t.addLayer(i))}var r,i,a=t.noteLayer,s=$("#sidebar_content"),l={},c=$(".control-note .control-button"),u={new:L.icon({iconUrl:OSM.NEW_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),open:L.icon({iconUrl:OSM.OPEN_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),closed:L.icon({iconUrl:OSM.CLOSED_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]})};return c.on("click",(function(t){t.preventDefault(),t.stopPropagation(),$(this).hasClass("disabled")||OSM.router.route("/note/new")})),l.pushstate=l.popstate=function(t){OSM.loadSidebarContent(t,(function(){l.load(t)}))},l.load=function(o){function i(t){$(t.target.form.add).prop("disabled",""===$(t.target).val())}if(!c.hasClass("disabled")&&!c.hasClass("active")){c.addClass("active"),t.addLayer(a);var l,p=Qs.parse(o.substring(o.indexOf("?")+1));return l=p.lat&&p.lon?L.latLng(p.lat,p.lon):t.getCenter(),t.panInside(l,{padding:[50,50]}),(r=L.marker(l,{icon:u.new,opacity:.9,draggable:!0})).on("dragstart dragend",(function(t){n(r.getLatLng(),t.type)})),r.addTo(a),n(r.getLatLng()),r.on("remove",(function(){c.removeClass("active")})).on("dragstart",(function(){$(r).stopTime("removenote")})).on("dragend",(function(){s.find("textarea").focus()})),s.find("textarea").on("input",i).focus(),s.find("input[type=submit]").on("click",(function(t){t.preventDefault(),e(r,t.target.form,"/api/0.6/notes.json")})),t.getState()}},l.unload=function(){r&&a.removeLayer(r),i&&t.removeLayer(i),c.removeClass("active")},l},OSM.Directions=function(t){function e(e,o){var n={};return n.marker=L.marker([0,0],{icon:L.icon({iconUrl:o,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:OSM.MARKER_SHADOW,shadowSize:[41,41]}),draggable:!0,autoPan:!0}),n.marker.on("drag dragend",(function(e){var o="drag"===e.type;o&&!u.draggable||o&&c||(n.setLatLng(e.target.getLatLng()),t.hasLayer(d)&&s(!1,!o))})),e.on("keydown",(function(){e.removeClass("error")})),e.on("change",(function(t){l=!0;var e=t.target.value;n.setValue(e)})),n.setValue=function(t,o){n.value=t,delete n.latlng,e.removeClass("error"),e.val(t),o?n.setLatLng(o):n.getGeocode()},n.getGeocode=function(){if(n.value){n.awaitingGeocode=!0;var o=t.getBounds().toBBoxString();$.getJSON(OSM.NOMINATIM_URL+"search?q="+encodeURIComponent(n.value)+"&format=json&viewbox="+o,(function(t){if(n.awaitingGeocode=!1,n.hasGeocode=!0,0===t.length)return e.addClass("error"),void alert(I18n.t("javascripts.directions.errors.no_place",{place:n.value}));n.setLatLng(L.latLng(t[0])),e.val(t[0].display_name),l&&(l=!1,s(!0,!0))}))}},n.setLatLng=function(o){var r=OSM.zoomPrecision(t.getZoom());e.val(o.lat.toFixed(r)+", "+o.lng.toFixed(r)),n.hasGeocode=!0,n.latlng=o,n.marker.setLatLng(o).addTo(t)},n}function o(t){return t<1e3?I18n.t("javascripts.directions.distance_m",{distance:Math.round(t)}):t<1e4?I18n.t("javascripts.directions.distance_km",{distance:(t/1e3).toFixed(1)}):I18n.t("javascripts.directions.distance_km",{distance:Math.round(t/1e3)})}function n(t){return I18n.t("javascripts.directions.distance_m",{distance:Math.round(t)})}function r(t){var e=Math.round(t/60),o=Math.floor(e/60);return o+":"+((e-=60*o)<10?"0":"")+e}function i(t){return y.findIndex((function(e){return e.id===t}))}function a(t){u=y[t],g.val(t)}function s(e,i){c&&c.abort();for(var a=0;a<2;++a){var s=h[a];s.hasGeocode||s.awaitingGeocode||(s.getGeocode(),l=!0)}if(h[0].awaitingGeocode||h[1].awaitingGeocode)l=!0;else{var m=h[0].latlng,y=h[1].latlng;if(m&&y){$("header").addClass("closed");var g=OSM.zoomPrecision(t.getZoom());OSM.router.replace("/directions?"+Qs.stringify({engine:u.id,route:m.lat.toFixed(g)+","+m.lng.toFixed(g)+";"+y.lat.toFixed(g)+","+y.lng.toFixed(g)})),$("#sidebar_content").html($(".directions_form .loader_copy").html()),t.setSidebarOverlaid(!1),c=u.getRoute([m,y],(function(a,s){if(c=null,a)return t.removeLayer(d),void(i&&$("#sidebar_content").html('<div class="alert alert-danger">'+I18n.t("javascripts.directions.errors.no_route")+"</div>"));d.setLatLngs(s.line).addTo(t),e&&t.fitBounds(d.getBounds().pad(.05));var l=$("<p>").append(I18n.t("javascripts.directions.distance")+": "+o(s.distance)+". "+I18n.t("javascripts.directions.time")+": "+r(s.time)+".");void 0!==s.ascend&&void 0!==s.descend&&l.append($("<br>"),I18n.t("javascripts.directions.ascend")+": "+n(s.ascend)+". "+I18n.t("javascripts.directions.descend")+": "+n(s.descend)+".");var h=$("<table class='table table-sm mb-3'>").append($("<tbody>")),m=$("<button type='button' class='btn-close'>").attr("aria-label",I18n.t("javascripts.close"));$("#sidebar_content").empty().append($("<div class='d-flex'>").append($("<h2 class='flex-grow-1 text-break'>").text(I18n.t("javascripts.directions.directions")),$("<div>").append(m)),l,h),s.steps.forEach((function(e){var o=e[0],n=e[1],r=e[2],i=e[3],a=e[4];i=i<5?"":i<200?String(10*Math.round(i/10))+"m":i<1500?String(100*Math.round(i/100))+"m":i<5e3?String(Math.round(i/100)/10)+"km":String(Math.round(i/1e3))+"km";var s=$("<tr class='turn'/>");s.append("<td class='border-0'><div class='direction i"+n+"'/></td> "),s.append("<td>"+r),s.append("<td class='distance text-muted text-end'>"+i),s.on("click",(function(){p.setLatLng(o).setContent("<p>"+r+"</p>").openOn(t)})),s.hover((function(){f.setLatLngs(a).addTo(t)}),(function(){t.removeLayer(f)})),h.append(s)})),$("#sidebar_content").append('<p class="text-center">'+I18n.t("javascripts.directions.instructions.courtesy",{link:u.creditline})+"</p>"),m.on("click",(function(){t.removeLayer(d),$("#sidebar_content").html(""),t.setSidebarOverlaid(!0)}))}))}}}var l,c,u,p=L.popup({autoPanPadding:[100,100]}),d=L.polyline([],{color:"#03f",opacity:.3,weight:10}),f=L.polyline([],{color:"#ff0",opacity:.5,weight:12
}),h=[e($("input[name='route_from']"),OSM.MARKER_GREEN),e($("input[name='route_to']"),OSM.MARKER_RED)],m=new Date;m.setYear(m.getFullYear()+10);var y=OSM.Directions.engines;y.sort((function(t,e){var o=I18n.t("javascripts.directions.engines."+t.id),n=I18n.t("javascripts.directions.engines."+e.id);return o.localeCompare(n)}));var g=$("select.routing_engines");y.forEach((function(t,e){g.append("<option value='"+e+"'>"+I18n.t("javascripts.directions.engines."+t.id)+"</option>")})),$(".directions_form .reverse_directions").on("click",(function(){var t=h[0].latlng,e=h[1].latlng,o="",n="";t&&(o=t.lat+","+t.lng),e&&(n=e.lat+","+e.lng),OSM.router.route("/directions?"+Qs.stringify({from:$("#route_to").val(),to:$("#route_from").val(),route:n+";"+o}))})),$(".directions_form .btn-close").on("click",(function(e){e.preventDefault();var o=h[0].value;o?OSM.router.route("/?query="+encodeURIComponent(o)+OSM.formatHash(t)):OSM.router.route("/"+OSM.formatHash(t))}));var v=i("fossgis_osrm_car");Cookies.get("_osm_directions_engine")&&(v=i(Cookies.get("_osm_directions_engine"))),a(v),g.on("change",(function(t){u=y[t.target.selectedIndex],Cookies.set("_osm_directions_engine",u.id,{secure:!0,expires:m,path:"/",samesite:"lax"}),s(!0,!0)})),$(".directions_form").on("submit",(function(t){t.preventDefault(),s(!0,!0)})),$(".routing_marker").on("dragstart",(function(t){var e=t.originalEvent.dataTransfer;e.effectAllowed="move";var o={type:$(this).data("type")};if(e.setData("text",JSON.stringify(o)),e.setDragImage){var n=$("<img>").attr("src",$(t.originalEvent.target).attr("src"));e.setDragImage(n.get(0),12,21)}}));var b={};return b.pushstate=b.popstate=function(){$(".search_form").hide(),$(".directions_form").show(),$("#map").on("dragend dragover",(function(t){t.preventDefault()})),$("#map").on("drop",(function(e){e.preventDefault();var o=e.originalEvent,n=JSON.parse(o.dataTransfer.getData("text")).type,r=L.DomEvent.getMousePosition(o,t.getContainer());r.y+=20;var i=t.containerPointToLatLng(r);h["from"===n?0:1].setLatLng(i),s(!0,!0)}));var e=Qs.parse(location.search.substring(1)),o=(e.route||"").split(";"),n=o[0]&&L.latLng(o[0].split(",")),r=o[1]&&L.latLng(o[1].split(","));if(e.engine){var l=i(e.engine);l>=0&&a(l)}h[0].setValue(e.from||"",n),h[1].setValue(e.to||"",r),t.setSidebarOverlaid(!n||!r),s(!0,!0)},b.load=function(){b.pushstate()},b.unload=function(){$(".search_form").show(),$(".directions_form").hide(),$("#map").off("dragend dragover drop"),t.removeLayer(p).removeLayer(d).removeLayer(h[0].marker).removeLayer(h[1].marker)},b},OSM.Directions.engines=[],OSM.Directions.addEngine=function(t,e){("http:"===document.location.protocol||e)&&OSM.Directions.engines.push(t)},OSM.Directions.addEngine(new FOSSGISOSRMEngine("fossgis_osrm_car","car"),!0),OSM.Directions.addEngine(new FOSSGISOSRMEngine("fossgis_osrm_bike","bike"),!0),OSM.Directions.addEngine(new FOSSGISOSRMEngine("fossgis_osrm_foot","foot"),!0),OSM.Directions.addEngine(new FOSSGISValhallaEngine("fossgis_valhalla_car","auto"),!0),OSM.Directions.addEngine(new FOSSGISValhallaEngine("fossgis_valhalla_bicycle","bicycle"),!0),OSM.Directions.addEngine(new FOSSGISValhallaEngine("fossgis_valhalla_foot","pedestrian"),!0),OSM.Directions.addEngine(new GraphHopperEngine("graphhopper_car","car"),!0),OSM.Directions.addEngine(new GraphHopperEngine("graphhopper_bicycle","bike"),!0),OSM.Directions.addEngine(new GraphHopperEngine("graphhopper_foot","foot"),!0),OSM.Changeset=function(t){function e(e,o){t.addObject({type:"changeset",id:parseInt(e,10)},(function(e){window.location.hash||!e.isValid()||!o&&t.getBounds().contains(e)||OSM.router.withoutMoveListener((function(){t.fitBounds(e)}))}))}function o(t,e,o){var n;a.find("#comment-error").prop("hidden",!0),a.find("button[data-method][data-url]").prop("disabled",!0),n=o?{text:a.find("textarea").val()}:{},$.ajax({url:e,type:t,oauth:!0,data:n,success:function(){OSM.loadSidebarContent(window.location.pathname,i.load)},error:function(t){a.find("button[data-method][data-url]").prop("disabled",!1),a.find("#comment-error").text(t.responseText).prop("hidden",!1).get(0).scrollIntoView({block:"nearest"})}})}function n(){a.find("button[data-method][data-url]").on("click",(function(t){t.preventDefault();var e=$(t.target).data(),n="comment"===t.target.name;o(e.method,e.url,n)})),a.find("textarea").on("input",(function(t){var e=t.target.form;""===$(t.target).val()?$(e.comment).prop("disabled",!0):$(e.comment).prop("disabled",!1)})),a.find("textarea").val("").trigger("input")}var r,i={},a=$("#sidebar_content");return i.pushstate=i.popstate=function(t,e){OSM.loadSidebarContent(t,(function(){i.load(t,e)}))},i.load=function(t,o){o&&(r=o),n(),e(r,!0)},i.unload=function(){t.removeObject()},i},OSM.Query=function(t){function e(){var e=$(this).data("geometry");e&&t.addLayer(e),$(this).addClass("selected")}function o(){var e=$(this).data("geometry");e&&t.removeLayer(e),$(this).removeClass("selected")}function n(t){if(t.tags)for(var e in t.tags)if(g.indexOf(e)<0)return!0;return!1}function r(t){var e=t.tags,o="";if("administrative"===e.boundary&&e.admin_level)o=I18n.t("geocoder.search_osm_nominatim.admin_levels.level"+e.admin_level,{defaultValue:I18n.t("geocoder.search_osm_nominatim.prefix.boundary.administrative")});else{var n,r,i=I18n.t("geocoder.search_osm_nominatim.prefix");for(n in e)if(r=e[n],i[n]&&i[n][r])return i[n][r];for(n in e){if(r=e[n],i[n])return r.slice(0,1).toUpperCase()+r.slice(1).replace(/_/g," ")}}return o||(o=I18n.t("javascripts.query."+t.type)),o}function i(t){for(var e=t.tags,o=OSM.preferred_languages,n=0;n<o.length;n++)if(e["name:"+o[n]])return e["name:"+o[n]];return e.name?e.name:e.ref?e.ref:e["addr:housename"]?e["addr:housename"]:e["addr:housenumber"]&&e["addr:street"]?e["addr:housenumber"]+" "+e["addr:street"]:"#"+t.id}function a(t){var e;return"node"===t.type&&t.lat&&t.lon?e=L.circleMarker([t.lat,t.lon],v):"way"===t.type&&t.geometry&&t.geometry.length>0?e=L.polyline(t.geometry.filter((function(t){return null!==t})).map((function(t){return[t.lat,t.lon]})),v):"relation"===t.type&&t.members&&(e=L.featureGroup(t.members.map(a).filter((function(t){return void 0!==t})))),e}function s(t,e,o,s,l,c){var u=s.find("ul");u.empty(),s.show(),s.data("ajax")&&s.data("ajax").abort(),s.data("ajax",$.ajax({url:h,method:"POST",data:{data:"[timeout:10][out:json];"+o},xhrFields:{withCredentials:m},success:function(t){var e;s.find(".loader").hide(),l?(e=t.elements.reduce((function(t,e){var o=e.type+e.id;return"geometry"in e&&delete e.bounds,t[o]=$.extend({},t[o],e),t}),{}),e=Object.keys(e).map((function(t){return e[t]}))):e=t.elements,c&&(e=e.sort(c));for(var o=0;o<e.length;o++){var p=e[o];if(n(p)){var d=$("<li>").addClass("query-result list-group-item").data("geometry",a(p)).text(r(p)+" ").appendTo(u);$("<a>").attr("href","/"+p.type+"/"+p.id).text(i(p)).appendTo(d)}}t.remark&&$("<li>").addClass("query-result list-group-item").text(I18n.t("javascripts.query.error",{server:h,error:t.remark})).appendTo(u),0===u.find("li").length&&$("<li>").addClass("query-result list-group-item").text(I18n.t("javascripts.query.nothing_found")).appendTo(u)},error:function(t,e,o){s.find(".loader").hide(),$("<li>").addClass("query-result list-group-item").text(I18n.t("javascripts.query."+e,{server:h,error:o})).appendTo(u)}}))}function l(t,e){return(t.bounds.maxlon-t.bounds.minlon)*(t.bounds.maxlat-t.bounds.minlat)-(e.bounds.maxlat-e.bounds.minlat)*(e.bounds.maxlat-e.bounds.minlat)}function c(e,o){var n=L.latLng(e,o).wrap(),r=t.getBounds().wrap(),i=OSM.zoomPrecision(t.getZoom()),a=r.getSouth().toFixed(i)+","+r.getWest().toFixed(i)+","+r.getNorth().toFixed(i)+","+r.getEast().toFixed(i),c=10*Math.pow(1.5,19-t.getZoom()),u="around:"+c+","+e+","+o,p="("+("node("+u+")")+";"+("way("+u+")")+";);out tags geom("+a+");"+("relation("+u+")")+";out geom("+a+");",d="is_in("+e+","+o+")->.a;way(pivot.a);out tags bb;out ids geom("+a+");relation(pivot.a);out tags bb;";$("#sidebar_content .query-intro").hide(),f&&t.removeLayer(f),f=L.circle(n,c,v).addTo(t),$(document).everyTime(75,"fadeQueryMarker",(function(e){10===e?t.removeLayer(f):f.setStyle({opacity:1-.1*e,fillOpacity:.5-.05*e})}),10),s(n,c,p,$("#query-nearby"),!1),s(n,c,d,$("#query-isin"),!0,l)}function u(e){var o=OSM.zoomPrecision(t.getZoom()),n=e.latlng.wrap(),r=n.lat.toFixed(o),i=n.lng.toFixed(o);OSM.router.route("/query?lat="+r+"&lon="+i)}function p(){y.addClass("active"),t.on("click",u),$(t.getContainer()).addClass("query-active")}function d(){f&&t.removeLayer(f),$(t.getContainer()).removeClass("query-active").removeClass("query-disabled"),t.off("click",u),y.removeClass("active")}var f,h=OSM.OVERPASS_URL,m=OSM.OVERPASS_CREDENTIALS,y=$(".control-query .control-button"),g=["source","source_ref","source:ref","history","attribution","created_by","tiger:county","tiger:tlid","tiger:upload_uuid","KSJ2:curve_id","KSJ2:lat","KSJ2:lon","KSJ2:coordinate","KSJ2:filename","note:ja"],v={color:"#FF6200",weight:4,opacity:1,fillOpacity:.5,interactive:!1};y.on("click",(function(t){t.preventDefault(),t.stopPropagation(),y.hasClass("active")?d():y.hasClass("disabled")||p()})).on("disabled",(function(){y.hasClass("active")&&(t.off("click",u),$(t.getContainer()).removeClass("query-active").addClass("query-disabled"),$(this).tooltip("show"))})).on("enabled",(function(){y.hasClass("active")&&(t.on("click",u),$(t.getContainer()).removeClass("query-disabled").addClass("query-active"),$(this).tooltip("hide"))})),$("#sidebar_content").on("mouseover",".query-results li.query-result",e).on("mouseout",".query-results li.query-result",o).on("mousedown",".query-results li.query-result",(function(){var e=!1;$(this).one("click",(function(o){if(!e){var n=$(this).data("geometry");n&&t.removeLayer(n),$(o.target).is("a")||$(this).find("a").simulate("click",o)}})).one("mousemove",(function(){e=!0}))}));var b={};return b.pushstate=b.popstate=function(t){OSM.loadSidebarContent(t,(function(){b.load(t,!0)}))},b.load=function(e,o){var n=Qs.parse(e.substring(e.indexOf("?")+1)),r=L.latLng(n.lat,n.lon);window.location.hash||o||t.getBounds().contains(r)||OSM.router.withoutMoveListener((function(){t.setView(r,15)})),c(n.lat,n.lon)},b.unload=function(t){t||(d(),$("#sidebar_content .query-results li.query-result.selected").each(o))},b},OSM.Router=function(t,e){function o(t,e){var o=new RegExp("^"+t.replace(n,"\\$&").replace(r,"(?:$1)?").replace(i,(function(t,e){return e?t:"([^/]+)"})).replace(a,"(.*?)")+"(?:\\?.*)?$"),s={match:function(t){return o.test(t)},run:function(t,n){var r=[];return n&&(r=o.exec(n).map((function(t,e){return e>0&&t?decodeURIComponent(t):t}))),r=r.concat(Array.prototype.slice.call(arguments,2)),(e[t]||$.noop).apply(e,r)}};return s}var n=/[-{}[\]+?.,\\^$|#\s]/g,r=/\((.*?)\)/g,i=/(\(\?)?:\w+/g,a=/\*\w+/g,s=[];for(var l in e)s.push(new o(l,e[l]));s.recognize=function(t){for(var e=0;e<this.length;e++)if(this[e].match(t))return this[e]};var c=window.location.pathname.replace(/(.)\/$/,"$1")+window.location.search,u=s.recognize(c),p=location.hash||OSM.formatHash(t),d={};return $(window).on("popstate",(function(e){if(e.originalEvent.state){var o=window.location.pathname+window.location.search,n=s.recognize(o);o!==c&&(u.run("unload",null,n===u),c=o,(u=n).run("popstate",c),t.setState(e.originalEvent.state,{animate:!1}))}})),d.route=function(e){var o=e.replace(/#.*/,""),n=s.recognize(o);if(!n)return!1;u.run("unload",null,n===u);var r=OSM.parseHash(e);return t.setState(r),window.history.pushState(r,document.title,e),c=o,(u=n).run("pushstate",c),!0},d.replace=function(t){window.history.replaceState(OSM.parseHash(t),document.title,t)},d.stateChange=function(t){t.center?window.history.replaceState(t,document.title,OSM.formatHash(t)):window.history.replaceState(t,document.title,window.location)},d.updateHash=function(){var e=OSM.formatHash(t);e!==p&&(p=e,d.stateChange(OSM.parseHash(e)))},d.hashUpdated=function(){var e=location.hash;if(e!==p){p=e;var o=OSM.parseHash(e);t.setState(o),d.stateChange(o,e)}},d.withoutMoveListener=function(e){function o(){t.off("moveend",d.updateHash),t.once("moveend",(function(){t.on("moveend",d.updateHash)}))}t.once("movestart",o),e(),t.off("movestart",o)},d.load=function(){var t=u.run("load",c);d.stateChange(t||{})},d.setCurrentPath=function(t){c=t,u=s.recognize(c)},t.on("moveend baselayerchange overlaylayerchange",d.updateHash),$(window).on("hashchange",d.hashUpdated),d};